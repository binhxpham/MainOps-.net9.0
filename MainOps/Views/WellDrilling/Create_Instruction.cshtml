@model MainOps.Models.WellDrillingInstructionVM

@{
    ViewData["Title"] = "Create_Instruction";
}

<h2>@SharedLocalizer.GetLocalizedHtmlString("Opret Boreinstruks")</h2>

<hr />
<form asp-action="Create_Instruction" enctype="multipart/form-data" method="post">
    <div style="width:100%;">
        <table style="width:100%;table-layout:fixed;">
            <tr>
                <td><label asp-for="ProjectId" class="control-label"></label></td>
                <td>
                    <select asp-for="ProjectId" class="form-control" asp-items="ViewBag.ProjectId">
                        <option value="">@SharedLocalizer.GetLocalizedHtmlString("Please Select Project")</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label asp-for="DrillPlace" class="control-label"></label></td>
                <td><input asp-for="DrillPlace" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Date" class="control-label"></label></td>
                <td><input type="datetime-local" asp-for="Date" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Address" class="control-label"></label></td>
                <td><input asp-for="Address" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="WellID" class="control-label"></label></td>
                <td><input asp-for="WellID" class="form-control" /></td>
            </tr>
            <tr>
                <td colspan="2">
                    <h3>@SharedLocalizer.GetLocalizedHtmlString("Drill Info")</h3>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Borerig" class="control-label"></label></td>
                <td><input asp-for="Borerig" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Boringstype" class="control-label"></label></td>
                <td>
                    <select asp-for="Boringstype" class="form-control">
                        <option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Drilling Type")</option>
                        <option value="Monitoring Well">@SharedLocalizer.GetLocalizedHtmlString("Monitoring")</option>
                        <option value="Pumping Well">@SharedLocalizer.GetLocalizedHtmlString("Pump")</option>
                        <option value="Reinfiltration Well">@SharedLocalizer.GetLocalizedHtmlString("Reinfiltration")</option>
                        <option value="Drinking Well">@SharedLocalizer.GetLocalizedHtmlString("Drinking Well")</option>
                        <option value="Pre Examination Well">@SharedLocalizer.GetLocalizedHtmlString("Pre Examination Well")</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Boremetode" class="control-label"></label></td>
                <td>
                    <select asp-for="Boremetode" class="form-control">
                        <option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Drill Method")</option>
                        <option value="DTH">@SharedLocalizer.GetLocalizedHtmlString("DTH")</option>
                        <option value="Flush">@SharedLocalizer.GetLocalizedHtmlString("Flush")</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Belaegning" class="control-label"></label></td>
                <td><input asp-for="Belaegning" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Forgravning" class="control-label"></label></td>
                <td>
                    <select asp-for="Forgravning" class="form-control">
                        <option value="No">@SharedLocalizer.GetLocalizedHtmlString("No")</option>
                        <option value="Yes">@SharedLocalizer.GetLocalizedHtmlString("Yes")</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Reetablering" class="control-label"></label></td>
                <td>
                    <select asp-for="Reetablering" class="form-control">
                        <option value="No">@SharedLocalizer.GetLocalizedHtmlString("No")</option>
                        <option value="Yes">@SharedLocalizer.GetLocalizedHtmlString("Yes")</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <h3>@SharedLocalizer.GetLocalizedHtmlString("Permits")</h3>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Boretilladelse" class="control-label"></label></td>
                <td><input asp-for="Boretilladelse" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Boretilladelse_Path" class="control-label"></label></td>
                <td><input type="file" accept=".pdf" name="Boretilladelse_fil" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Afledningstilladelse" class="control-label"></label></td>
                <td><input asp-for="Afledningstilladelse" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Aflednignstilladelse_Path" class="control-label"></label></td>
                <td><input type="file" accept=".pdf" name="Afledningstilladelse_fil" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="RaadenOverVej" class="control-label"></label></td>
                <td><input asp-for="RaadenOverVej" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="RaadenOverVej_Path" class="control-label"></label></td>
                <td><input type="file" accept=".pdf" name="RaadenOverVej_fil" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Gravetilladelse" class="control-label"></label></td>
                <td><input asp-for="Gravetilladelse" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Gravetilladelse_Path" class="control-label"></label></td>
                <td><input type="file" accept=".pdf" name="Gravetilladelse_fil" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Ledningsoplysninger" class="control-label"></label></td>
                <td><input asp-for="Ledningsoplysninger" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Ledningsoplysninger_Path" class="control-label"></label></td>
                <td><input type="file" multiple accept=".pdf,.dwg" name="LedningsOplysninger_fil" class="form-control" /></td>
            </tr>
            <tr>
                <td colspan="2">
                    <h3>@SharedLocalizer.GetLocalizedHtmlString("Filtre og Gruskastning")</h3>
                </td>
            </tr>
            <tr>
                <td><label asp-for="ToFiltre" class="control-label"></label></td>
                <td><input asp-for="ToFiltre" value="true" checked="checked" onclick="$(this).val(this.checked ? true : false)" /></td>
            </tr>
            <tr>
                <td><label asp-for="Filter1_Dim" class="control-label"></label></td>
                <td><input asp-for="Filter1_Dim" class="form-control" onchange="BuildTable();" /></td>
            </tr>
            <tr>
                <td><label asp-for="Blindroer1" class="control-label"></label></td>
                <td><input asp-for="Blindroer1" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Filterroer1" class="control-label"></label></td>
                <td><input asp-for="Filterroer1" class="form-control" /></td>
            </tr>
            <tr class="roer2">
                <td><label asp-for="Filter2_Dim" class="control-label"></label></td>
                <td><input asp-for="Filter2_Dim" class="form-control" onchange="BuildTable();" /></td>
            </tr>
            <tr class="roer2">
                <td><label asp-for="Blindroer2" class="control-label"></label></td>
                <td><input asp-for="Blindroer2" class="form-control" /></td>
            </tr>
            <tr class="roer2">
                <td><label asp-for="Filterroer2" class="control-label"></label></td>
                <td><input asp-for="Filterroer2" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Filterslidser" class="control-label"></label></td>
                <td>
                    <select asp-for="Filterslidser" class="form-control">
                        <option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Filter Slots")</option>
                        <option value="1mm">1mm</option>
                        <option value="2mm">2mm</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Grustype" class="control-label"></label></td>
                <td>
                    <select asp-for="Grustype" class="form-control">
                        <option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Gravel Type")</option>
                        <option value="DanSand1">0,1mm DanSand 1</option>
                        <option value="DanSand3">0,3mm Dansand 3</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label asp-for="Taetningsringe" class="control-label"></label></td>
                <td><input asp-for="Taetningsringe" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Filterstyr" class="control-label"></label></td>
                <td><input asp-for="Filterstyr" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="Forsegling" class="control-label"></label></td>
                <td><input asp-for="Forsegling" class="form-control" /></td>
            </tr>
            <tr>
                <td colspan="2"><h3>@SharedLocalizer.GetLocalizedHtmlString("Remarks")</h3></td>
            </tr>
            <tr>
                <td colspan="2"><label asp-for="Registrering" class="control-label"></label></td>
            </tr>
            <tr>
                <td colspan="2"><textarea asp-for="Registrering" cols="36" rows="10" placeholder="@SharedLocalizer.GetLocalizedHtmlString("What to register during drilling...")" style="width:100%;"></textarea></td>
            </tr>
            <tr>
                <td><label asp-for="ProeveFrekvens" class="control-label"></label></td>
                <td><input asp-for="ProeveFrekvens" class="form-control" /></td>
            </tr>
            <tr>
                <td><label asp-for="BoreDybde" class="control-label"></label></td>
                <td><input asp-for="BoreDybde" type="number" step="0.01" class="form-control" /></td>
            </tr>
            <tr hidden="hidden">
                <td colspan="2">
                    <h3>@SharedLocalizer.GetLocalizedHtmlString("Set up of filters")</h3>
                </td>
            </tr>
            <tr hidden="hidden">
                <td><label asp-for="Filter1_Laengde" class="control-label"></label></td>
                <td><input asp-for="Filter1_Laengde" type="number" step="0.01" class="form-control" onchange="UpdateF1Laengde();" /></td>
            </tr>
            <tr class="roer2" hidden="hidden">
                <td><label asp-for="Filter2_Laengde" class="control-label"></label></td>
                <td><input asp-for="Filter2_Laengde" type="number" step="0.01" class="form-control" onchange="UpdateF2Laengde();" /></td>
            </tr>
        </table>
    </div>
    <table>
        <tr>
            <td rowspan="2" style="width:33%;">
                <table style="width:100%;border:medium;">
                    <thead>
                        <tr>
                            <th colspan="3" style="width:100%;text-align:center;">@SharedLocalizer.GetLocalizedHtmlString("Ground Layers")</th>
                        </tr>
                        <tr>
                            <th style="width:70%;">@SharedLocalizer.GetLocalizedHtmlString("Layer Type")</th>
                            <th style="width:30%;">@SharedLocalizer.GetLocalizedHtmlString("Layer % of drawing")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{ int LayerNumberVar = 1;}
                        @for (int i = 0; i < Model.Layers.Count(); i++)
                        {
                            <tr>
                                <td><select asp-for="@Model.Layers[i].LayerId" asp-items="ViewBag.Layers" style="width:100%;" id="Layer_@LayerNumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select></td>
                                <td>
                                    <input asp-for="@Model.Layers[i].Percent" type="number" id="Percent_@LayerNumberVar" step="1" max="100" min="0" onchange="BuildTable();" /><input asp-for="@Model.Layers[i].LayerNumber" value="@LayerNumberVar" style="width:100%;" id="LayerNumber_@LayerNumberVar" hidden="hidden" />
                                    <input asp-for="@Model.Layers[i].LayerNumber" value="@LayerNumberVar" hidden="hidden" />
                                </td>
                            </tr>

                            LayerNumberVar += 1;
                        }
                        @*@foreach (var item in Model.Layers)
                            {
                                <tr>
                                    <td><select asp-for="@item.LayerId" asp-items="ViewBag.Layers" style="width:100%;" id="Layer_@LayerNumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select></td>
                                    <td>
                                        <input asp-for="@item.Percent" type="number" id="Percent_@LayerNumberVar" step="1" max="100" min="0" onchange="BuildTable();" /><input asp-for="@item.LayerNumber" value="@LayerNumberVar" style="width:100%;" id="LayerNumber_@LayerNumberVar" hidden="hidden" />
                                        <input asp-for="@item.LayerNumber" value="@LayerNumberVar" hidden="hidden" />
                                    </td>
                                </tr>

                                LayerNumberVar += 1;
                            }*@
                    </tbody>
                </table>
            </td>
            <td rowspan="2" style="width:33%;">
                <table style="width:100%;border:medium;">
                    <thead>
                        <tr>
                            <th colspan="4" style="width:100%;text-align:center;">
                                @SharedLocalizer.GetLocalizedHtmlString("Bentonite Positions")
                            </th>
                        </tr>
                        <tr>
                            <th style="width:16%">@SharedLocalizer.GetLocalizedHtmlString("Under")</th>
                            <th style="width:34%">@SharedLocalizer.GetLocalizedHtmlString("Layer")</th>
                            <th style="width:16%">@SharedLocalizer.GetLocalizedHtmlString("Over")</th>
                            <th style="width:34%">@SharedLocalizer.GetLocalizedHtmlString("Layer")</th>
                        </tr>
                    </thead>
                    <tbody>

                        @{ int BentoniteNumberVar = 1;}
                        @for (int i = 0; i < Model.BentoniteLayers.Count(); i++)
                        {

                            <tr>

                                <td>
                                    <input asp-for="@Model.BentoniteLayers[i].Under" value="0.0" type="number" step="0.01" style="width:100%" id="Under_@BentoniteNumberVar" onchange="BuildTable();" />
                                    <input asp-for="@Model.BentoniteLayers[i].CellStart" hidden="hidden" id="Bentonite_CellStart_@BentoniteNumberVar" />
                                    <input asp-for="@Model.BentoniteLayers[i].CellEnd" hidden="hidden" id="Bentonite_CellEnd_@BentoniteNumberVar" />
                                </td>
                                <td><select asp-for="@Model.BentoniteLayers[i].LayerTypeUnderId" asp-items="ViewBag.Layers" style="width:100%" id="BentoniteUnder_@BentoniteNumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select></td>
                                <td><input asp-for="@Model.BentoniteLayers[i].Over" value="0.0" type="number" step="0.01" style="width:100%" id="Over_@BentoniteNumberVar" onchange="BuildTable();" /></td>
                                <td><select asp-for="@Model.BentoniteLayers[i].LayerTypeOverId" asp-items="ViewBag.Layers" style="width:100%" id="BentoniteOver_@BentoniteNumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select> <input hidden="hidden" id="BentoniteLayer_@BentoniteNumberVar" value="@BentoniteNumberVar" /></td>

                            </tr>
                            BentoniteNumberVar += 1;
                        }

                    </tbody>
                </table>
            </td>
            <td style="width:33%;">
                <table style="width:100%;border:medium;">
                    <thead>
                        <tr>
                            <th colspan="4" style="width:100%;text-align:center;">
                                @SharedLocalizer.GetLocalizedHtmlString("Filter 1")
                            </th>
                        </tr>
                        <tr>
                            <th style="width:16%">@SharedLocalizer.GetLocalizedHtmlString("Under")</th>
                            <th style="width:28%">@SharedLocalizer.GetLocalizedHtmlString("Layer")</th>
                            <th style="width:16%">@SharedLocalizer.GetLocalizedHtmlString("Over")</th>
                            <th style="width:28%">@SharedLocalizer.GetLocalizedHtmlString("Layer")</th>
                            <th style="width:12%">@SharedLocalizer.GetLocalizedHtmlString("Length")</th>
                        </tr>
                    </thead>
                    <tbody>

                        @{ int Filter1NumberVar = 1;}
                        @for (int i = 0; i < Model.Filter1_Layers.Count(); i++)
                        {
                            <tr>
                                <td>
                                    <input asp-for="@Model.Filter1_Layers[i].Under" value="0.0" type="number" step="0.01" style="width:100%" id="Filter1mUnder_@Filter1NumberVar" onchange="BuildTable();" />
                                    <input asp-for="@Model.Filter1_Layers[i].CellStart" hidden="hidden" id="Filter1_CellStart_@Filter1NumberVar" />
                                    <input asp-for="@Model.Filter1_Layers[i].CellEnd" hidden="hidden" id="Filter1_CellEnd_@Filter1NumberVar" />
                                </td>
                                <td><select asp-for="@Model.Filter1_Layers[i].LayerTypeUnderId" asp-items="ViewBag.Layers" style="width:100%" id="Filter1Under_@Filter1NumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select></td>
                                <td><input asp-for="@Model.Filter1_Layers[i].Over" value="0.0" type="number" step="0.01" style="width:100%" id="Filter1mOver_@Filter1NumberVar" onchange="BuildTable();" /></td>
                                <td><select asp-for="@Model.Filter1_Layers[i].LayerTypeOverId" asp-items="ViewBag.Layers" style="width:100%" id="Filter1Over_@Filter1NumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select> </td>
                                <td><input asp-for="@Model.Filter1_Layers[i].Length" value="0.0" type="number" step="0.01" style="width:100%" id="Filter1m_@Filter1NumberVar" onchange="BuildTable();" /></td>
                            </tr>
                            Filter1NumberVar += 1;
                        }
                        <tr>
                            <td>@SharedLocalizer.GetLocalizedHtmlString("Add Blind Pipe?:")</td>
                            <td><input asp-for="BlindPipe1" type="checkbox" value="false" onchange="BuildTable();" /></td>
                            <td>@SharedLocalizer.GetLocalizedHtmlString("Meter blind pipe:")</td>
                            <td><input asp-for="BlindPipe1m" type="number" value="0.0" step="0.01" min="0" max="100" onchange="BuildTable();" /></td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <table style="width:100%;border:medium;">
                    <thead>
                        <tr>
                            <th colspan="4" style="width:100%;text-align:center;">
                                @SharedLocalizer.GetLocalizedHtmlString("Filter 2")
                            </th>
                        </tr>
                        <tr>
                            <th style="width:16%">@SharedLocalizer.GetLocalizedHtmlString("Under")</th>
                            <th style="width:28%">@SharedLocalizer.GetLocalizedHtmlString("Layer")</th>
                            <th style="width:16%">@SharedLocalizer.GetLocalizedHtmlString("Over")</th>
                            <th style="width:28%">@SharedLocalizer.GetLocalizedHtmlString("Layer")</th>
                            <th style="width:12%">@SharedLocalizer.GetLocalizedHtmlString("Length")</th>
                        </tr>
                    </thead>
                    <tbody>

                        @{ int Filter2NumberVar = 1;}
                        @for (int i = 0; i < Model.Filter2_Layers.Count(); i++)
                        {
                            <tr>
                                <td>
                                    <input asp-for="@Model.Filter2_Layers[i].Under" value="0.0" type="number" step="0.01" style="width:100%" id="Filter2mUnder_@Filter2NumberVar" onchange="BuildTable();" />
                                    <input asp-for="@Model.Filter2_Layers[i].CellStart" hidden="hidden" id="Filter2_CellStart_@Filter2NumberVar" />
                                    <input asp-for="@Model.Filter2_Layers[i].CellEnd" hidden="hidden" id="Filter2_CellEnd_@Filter2NumberVar" />
                                </td>
                                <td><select asp-for="@Model.Filter2_Layers[i].LayerTypeUnderId" asp-items="ViewBag.Layers" style="width:100%" id="Filter2Under_@Filter2NumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select></td>
                                <td><input asp-for="@Model.Filter2_Layers[i].Over" value="0.0" type="number" step="0.01" style="width:100%" id="Filter2mOver_@Filter2NumberVar" onchange="BuildTable();" /></td>
                                <td><select asp-for="@Model.Filter2_Layers[i].LayerTypeOverId" asp-items="ViewBag.Layers" style="width:100%" id="Filter2Over_@Filter2NumberVar" onchange="BuildTable();"><option value="">@SharedLocalizer.GetLocalizedHtmlString("Choose Layer Type")</option></select> </td>
                                <td><input asp-for="@Model.Filter2_Layers[i].Length" value="0.0" type="number" step="0.01" style="width:100%" id="Filter2m_@Filter2NumberVar" onchange="BuildTable();" /></td>
                            </tr>
                            Filter2NumberVar += 1;
                        }

                        <tr>
                            <td>@SharedLocalizer.GetLocalizedHtmlString("Add Blind Pipe?:")</td>
                            <td><input asp-for="BlindPipe2" type="checkbox" value="false" onchange="BuildTable();" /></td>
                            <td>@SharedLocalizer.GetLocalizedHtmlString("Meter blind pipe:")</td>
                            <td><input asp-for="BlindPipe2m" type="number" value="0.0" step="0.01" min="0" max="100" onchange="BuildTable();" /></td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
    <div style="width:100%;">
        <table id="myTable" style="width:100%;table-layout:fixed;"></table>
    </div>
    <div class="form-group">
        <button class="btn-hoelscher">@SharedLocalizer.GetLocalizedHtmlString("Save Drilling Instruction")</button>"
    </div>
</form>
@section Scripts
    {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
        var endofpipe1 = 0;
        var endofpipe2 = 0;
        var filtercount = @Model.Filter1_Layers.Count();
        function InsertValues() {
            var filter1length = $("#Filter1m_1").val();
            var filter1over = $("#Filter1mOver_1").val();
            var filter1under = $("#Filter1mUnder_1").val();
            var filter2length = $("#Filter2m_1").val();
            var filter2over = $("#Filter2mOver_1").val();
            var filter2under = $("#Filter2mUnder_1").val();
            $("#Filter1_Laengde").val(filter1length);
            $("#Filter1_Grus_Op").val(filter1over);
            $("#Filter1_Grus_Ned").val(filter1under);
            $("#Filter2_Laengde").val(filter2length);
            $("#Filter2_Grus_Op").val(filter2over);
            $("#Filter2_Grus_Ned").val(filter2under);
        }
        function BuildTable() {
            AmmendLastLayer();
            if ($("#BlindPipe1").prop("checked") == true) {
                $("#BlindPipe1").val(true);
            }
            else {
                $("#BlindPipe1").val(false);
            }
            if ($("#BlindPipe2").prop("checked") == true) {
                $("#BlindPipe2").val(true);
            }
            else {
                $("#BlindPipe2").val(false);
            }
            var twofilters = $("#ToFiltre").val();
            var table = document.getElementById("myTable");
            table.style.height = "800px";
            table.style.width = "600px";
            table.style.marginLeft = "auto";
            table.style.marginRight = "auto";
            $("#myTable tr").remove();
            for (j = 1; j <= 100; j++) {
                var row = table.insertRow(j - 1);
                row.id = "row_" + j;
                if (twofilters == "true") {
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    var cell5 = row.insertCell(4);
                    var cell6 = row.insertCell(5);
                    var cell7 = row.insertCell(6);
                    cell1.id = "cell_" + j + "_" + 1;
                    cell2.id = "cell_" + j + "_" + 2;
                    cell3.id = "cell_" + j + "_" + 3;
                    cell4.id = "cell_" + j + "_" + 4;
                    cell5.id = "cell_" + j + "_" + 5;
                    cell6.id = "cell_" + j + "_" + 6;
                    cell7.id = "cell_" + j + "_" + 7;
                    cell1.setAttribute('class', 'Layer');
                    cell7.setAttribute('class', 'Layer');
                    cell1.style.wordBreak = "break-word";
                    cell1.style.borderTop = "none";
                    cell1.style.borderLeft = "none";
                    cell1.style.borderRight = "none";
                    cell2.style.wordBreak = "break-all";
                    cell2.style.borderTop = "none";
                    cell3.style.wordBreak = "break-all";
                    cell4.style.wordBreak = "break-all";
                    cell4.style.borderTop = "none";
                    cell5.style.wordBreak = "break-all";
                    cell6.style.wordBreak = "break-all";
                    cell6.style.borderTop = "none";
                    cell6.style.borderRight = "none";
                    cell7.style.wordBreak = "break-word";
                    cell7.style.borderTop = "none";
                    cell7.style.borderLeft = "none";
                    cell7.style.borderRight = "none";

                    if (j > 1) {
                        cell2.setAttribute('class', 'Grus');
                        cell3.setAttribute('class', 'Grus');
                        cell4.setAttribute('class', 'Grus');
                        cell5.setAttribute('class', 'Grus');
                        cell6.setAttribute('class', 'Grus');
                    }
                    else {
                        cell3.setAttribute('class', 'Pipe');
                        cell5.setAttribute('class', 'Pipe');
                        cell1.style.width = "20%";
                        cell2.style.width = "15%";
                        cell3.style.width = "10%";
                        cell4.style.width = "10%";
                        cell5.style.width = "10%";
                        cell6.style.width = "15%";
                        cell7.style.width = "20%";

                    }
                }
                else {
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    var cell7 = row.insertCell(4);
                    cell1.id = "cell_" + j + "_" + 1;
                    cell2.id = "cell_" + j + "_" + 2;
                    cell3.id = "cell_" + j + "_" + 3;
                    cell4.id = "cell_" + j + "_" + 4;
                    cell7.id = "cell_" + j + "_" + 7;
                    cell1.setAttribute('class', 'Layer');
                    cell7.setAttribute('class', 'Layer');
                    cell1.style.wordBreak = "break-word";
                    cell1.style.borderTop = "none";
                    cell1.style.borderLeft = "none";
                    cell1.style.borderRight = "none";
                    cell2.style.wordBreak = "break-all";
                    cell2.style.borderTop = "none";
                    cell3.style.wordBreak = "break-all";
                    cell4.style.wordBreak = "break-all";
                    cell4.style.borderTop = "none";
                    cell7.style.wordBreak = "break-word";
                    cell7.style.borderTop = "none";
                    cell7.style.borderLeft = "none";
                    cell7.style.borderRight = "none";

                    if (j > 1) {
                        cell2.setAttribute('class', 'Grus');
                        cell3.setAttribute('class', 'Grus');
                        cell4.setAttribute('class', 'Grus');
                    }
                    else {
                        cell3.setAttribute('class', 'Pipe');
                        cell1.style.width = "25%";
                        cell2.style.width = "20%";
                        cell3.style.width = "15%";
                        cell4.style.width = "20%";
                        cell7.style.width = "25%";

                    }
                }
            }
            var m = 1;
            for (i = 1; i <= 10; i++) {
                var layertype = $("#Layer_" + i + " option:selected").text();
                var layerid = $("#Layer_" + i + " option:selected").val();
                var percent = +$("#Percent_" + i).val();
                if (layerid != "") {
                    if (twofilters == "true") {
                        var cell1 = document.getElementById("cell_" + m + "_" + 1);
                        var cell2 = document.getElementById("cell_" + m + "_" + 2);
                        var cell3 = document.getElementById("cell_" + m + "_" + 3);
                        var cell4 = document.getElementById("cell_" + m + "_" + 4);
                        var cell5 = document.getElementById("cell_" + m + "_" + 5);
                        var cell6 = document.getElementById("cell_" + m + "_" + 6);
                        var cell7 = document.getElementById("cell_" + m + "_" + 7);
                        for (k = 1; k < percent; k++) {
                            var celltoremove1 = document.getElementById("cell_" + (m + k) + "_" + 1);
                            var celltoremove7 = document.getElementById("cell_" + (m + k) + "_" + 7);
                            celltoremove1.parentNode.removeChild(celltoremove1);
                            celltoremove7.parentNode.removeChild(celltoremove7);
                        }
                        m = m + percent;
                        cell1.rowSpan = percent;
                        cell7.rowSpan = percent;
                        if (layerid == 1) {
                            cell1.innerHTML = layertype;
                            cell1.style.textAlign = "center";
                            cell1.setAttribute('class', 'Layer');
                            cell1.setAttribute('LayerId', layerid);
                            cell2.innerHTML = "";
                            cell3.innerHTML = $("#Filter1_Dim").val();
                            cell4.innerHTML = "";
                            cell5.innerHTML = $("#Filter2_Dim").val();
                            cell6.innerHTML = "";
                            cell7.innerHTML = layertype;
                            cell7.setAttribute('class', 'Layer');
                            cell7.setAttribute('LayerId', layerid);
                            cell7.style.textAlign = "center";
                        }
                        else {
                            if (layertype == "Bund af Brønd") {
                                cell1.innerHTML = layertype;
                                cell1.setAttribute('class', 'Layer');
                                cell1.setAttribute('LayerId', layerid);
                                cell1.colSpan = 7;
                                cell1.style.color = "white";
                                cell1.style.backgroundColor = "black";
                                cell1.style.textAlign = "center";
                            }
                            else {
                                cell1.innerHTML = layertype;
                                cell1.setAttribute('class', 'Layer');
                                cell1.setAttribute('LayerId', layerid);
                                cell2.innerHTML = "";
                                cell3.innerHTML = "";
                                cell4.innerHTML = "";
                                cell5.innerHTML = "";
                                cell6.innerHTML = "";
                                cell7.innerHTML = layertype;
                                cell7.setAttribute('class', 'Layer');
                                cell7.setAttribute('LayerId', layerid);
                            }
                        }
                    }
                    else {
                        var cell1 = document.getElementById("cell_" + m + "_" + 1);
                        var cell2 = document.getElementById("cell_" + m + "_" + 2);
                        var cell3 = document.getElementById("cell_" + m + "_" + 3);
                        var cell4 = document.getElementById("cell_" + m + "_" + 4);
                        var cell7 = document.getElementById("cell_" + m + "_" + 7);
                        for (k = 1; k < percent; k++) {
                            var celltoremove1 = document.getElementById("cell_" + (m + k) + "_" + 1);
                            var celltoremove7 = document.getElementById("cell_" + (m + k) + "_" + 7);
                            celltoremove1.parentNode.removeChild(celltoremove1);
                            celltoremove7.parentNode.removeChild(celltoremove7);
                        }
                        m = m + percent;
                        cell1.rowSpan = percent;
                        cell7.rowSpan = percent;
                        if (layerid == 1) {
                            cell1.innerHTML = layertype;
                            cell1.style.textAlign = "center";
                            cell1.setAttribute('class', 'Layer');
                            cell1.setAttribute('LayerId', layerid);
                            cell2.innerHTML = "";
                            cell3.innerHTML = $("#Filter1_Dim").val();
                            cell4.innerHTML = "";
                            cell7.innerHTML = layertype;
                            cell7.setAttribute('class', 'Layer');
                            cell7.style.textAlign = "center";
                            cell7.setAttribute('LayerId', layerid);
                        }
                        else {

                            if (layertype == "Bund af Brønd") {
                                cell1.innerHTML = layertype;
                                cell1.setAttribute('class', 'Layer');
                                cell1.setAttribute('LayerId', layerid);
                                cell1.colSpan = 5;
                                cell1.style.color = "white";
                                cell1.style.backgroundColor = "black";
                                cell1.style.textAlign = "center";
                            }
                            else {
                                cell1.innerHTML = layertype;
                                cell1.setAttribute('class', 'Layer');
                                cell1.setAttribute('LayerId', layerid);
                                cell2.innerHTML = "";
                                cell3.innerHTML = "";
                                cell4.innerHTML = "";
                                cell7.innerHTML = layertype;
                                cell7.setAttribute('class', 'Layer');
                                cell7.setAttribute('LayerId', layerid);
                            }

                        }
                    }
                }
            }
            UpdateBentoniteLayerList();
            UpdateFilter1LayerList();
            if (twofilters == "true") {
                UpdateFilter2LayerList();
            }
            BuildFilter1();
            if (twofilters == "true") {
                BuildFilter2();
            }
            CreatePipe1();
            if (twofilters == "true") {
                CreatePipe2();
            }
            BuildBentonite();
            // alert("built bentonite");
            MergeGrus();
            // alert("Merged grus");
            InsertGravelAgain();
            // alert("insertgravelagain done");
            PutColours();
            // alert("put the colors");
            InsertValues();
            // alert("inserted values");

        }


        function BuildBentonite() {
            for (i = 1; i <= 10; i++) {
                var underindex = +$("#BentoniteUnder_" + i + " option:selected").index();
                var overindex = +$("#BentoniteOver_" + i + " option:selected").index();
                var under = +$("#Under_" + i).val();
                var over = +$("#Over_" + i).val();
                var twofilters = $("#ToFiltre").val();
                var Bentoniteunderlayerid = $("#BentoniteUnder_" + i + " option:selected").val();
                var Bentoniteoverlayerid = $("#BentoniteOver_" + i + " option:selected").val();
                if (Bentoniteunderlayerid != "" && Bentoniteoverlayerid != "") {
                    var startsum = 0;
                    var endsum = 0;
                    if (overindex > underindex) {
                        if (under > 0) {
                            for (j = 1; j <= Bentoniteunderlayerid; j++) {
                                startsum += +$("#Percent_" + j).val();
                            }
                        }
                        else {
                            for (j = 1; j < Bentoniteunderlayerid; j++) {
                                startsum += +$("#Percent_" + j).val();
                            }
                        }
                        for (j = 1; j < Bentoniteoverlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        if (startsum < 1) {
                            startsum += 1;
                        }
                        if (over > 0) {
                            cell22 = document.getElementById("cell_" + endsum + "_" + 2);
                            cell44 = document.getElementById("cell_" + endsum + "_" + 4);
                            if (twofilters == "true") {
                                cell66 = document.getElementById("cell_" + endsum + "_" + 6);
                                cell66.innerHTML = over + " m";
                                cell66.setAttribute('class', 'GrusA');
                            }
                            cell22.innerHTML = over + " m";
                            cell44.innerHTML = over + " m";

                            cell22.setAttribute('class', 'GrusA');
                            cell44.setAttribute('class', 'GrusA');

                        }
                        if (under > 0) {
                            startsum += 1;
                            cell221 = document.getElementById("cell_" + startsum + "_" + 2);
                            cell441 = document.getElementById("cell_" + startsum + "_" + 4);
                            if (twofilters == "true") {
                                cell661 = document.getElementById("cell_" + startsum + "_" + 6);
                                cell661.innerHTML = under + " m";
                                cell661.setAttribute('class', 'GrusA');
                            }
                            cell221.innerHTML = under + " m";
                            cell441.innerHTML = under + " m";
                            cell221.setAttribute('class', 'GrusA');
                            cell441.setAttribute('class', 'GrusA');

                        }
                        if (over > 0) {
                            for (k = (startsum + 2); k <= endsum - 1; k++) {
                                if (startsum + 2 > endofpipe1) {
                                    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                                    celltoremove3.parentNode.removeChild(celltoremove3);
                                }
                                if (twofilters == "true") {
                                    if (startsum + 2 > endofpipe2) {
                                        celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                                        celltoremove5.parentNode.removeChild(celltoremove5);
                                    }
                                    celltoremove6 = document.getElementById("cell_" + k + "_" + 6);
                                    celltoremove6.parentNode.removeChild(celltoremove6);
                                }
                                celltoremove2 = document.getElementById("cell_" + k + "_" + 2);
                                celltoremove4 = document.getElementById("cell_" + k + "_" + 4);
                                celltoremove2.parentNode.removeChild(celltoremove2);
                                celltoremove4.parentNode.removeChild(celltoremove4);

                            }
                        }
                        else {
                            for (k = startsum + 2; k <= endsum; k++) {
                                if (startsum + 2 > endofpipe1) {
                                    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                                    celltoremove3.parentNode.removeChild(celltoremove3);
                                }
                                if (twofilters == "true") {
                                    if (startsum + 2 > endofpipe2) {
                                        celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                                        celltoremove5.parentNode.removeChild(celltoremove5);
                                    }
                                    celltoremove6 = document.getElementById("cell_" + k + "_" + 6);
                                    celltoremove6.parentNode.removeChild(celltoremove6);
                                }
                                celltoremove2 = document.getElementById("cell_" + k + "_" + 2);
                                celltoremove4 = document.getElementById("cell_" + k + "_" + 4);

                                celltoremove2.parentNode.removeChild(celltoremove2);
                                celltoremove4.parentNode.removeChild(celltoremove4);

                            }
                        }
                        cell2 = document.getElementById("cell_" + (startsum + 1) + "_" + 2);
                        cell4 = document.getElementById("cell_" + (startsum + 1) + "_" + 4);
                        if (twofilters == "true") {
                            cell6 = document.getElementById("cell_" + (startsum + 1) + "_" + 6);
                        }
                        if ((startsum + 1) == endofpipe1 && document.getElementById("cell_" + endofpipe1 + "_" + 3).className == "Blind") {

                            cell3 = document.getElementById("cell_" + (startsum + 1) + "_" + 3);
                            cell3.rowSpan = (endsum - startsum - 1);
                            cell3.setAttribute('class', 'Blind');
                            cell3.innerHTML = $("#BlindPipe1m").val() + " m";
                        }
                        else if (startsum + 2 > endofpipe1) { //this is new instead of commented out below

                            cell3 = document.getElementById("cell_" + (startsum + 1) + "_" + 3);
                        }
                        if (twofilters == "true") {
                            if ((startsum + 1) == endofpipe2 && document.getElementById("cell_" + endofpipe2 + "_" + 5).className == "Blind") {

                                cell5 = document.getElementById("cell_" + (startsum + 1) + "_" + 5);
                                cell5.rowSpan = (endsum - startsum - 1);
                                cell5.setAttribute('class', 'Blind');
                                cell5.innerHTML = $("#BlindPipe2m").val() + " m";
                            }
                            else if (startsum + 2 > endofpipe2) {

                                cell5 = document.getElementById("cell_" + (startsum + 1) + "_" + 5);
                                cell5.rowSpan = (endsum - startsum - 1);
                                cell5.setAttribute('class', 'Bentonite');
                                cell5.innerHTML = "Bentonit";
                            }
                        }
                        if (over > 0) {
                            cell2.rowSpan = (endsum - startsum - 1);
                            cell4.rowSpan = (endsum - startsum - 1);
                            if (twofilters == "true") {
                                cell6.rowSpan = (endsum - startsum - 1);
                            }
                            if (startsum + 2 > endofpipe1) {
                                cell3.rowSpan = (endsum - startsum - 1);
                                if ((startsum + 1) == endofpipe1 && document.getElementById("cell_" + endofpipe1 + "_" + 3).className == "Blind") {
                                }
                                else {
                                    cell3.setAttribute('class', 'Bentonite');
                                    cell3.innerHTML = "Bentonit"
                                }
                            }
                            if (twofilters == "true") {
                                if (startsum + 2 > endofpipe2) {
                                    cell5.rowSpan = (endsum - startsum - 1);
                                    if ((startsum + 1) == endofpipe2 && document.getElementById("cell_" + endofpipe2 + "_" + 3).className == "Blind") {
                                    }
                                    else {
                                        cell5.setAttribute('class', 'Bentonite');
                                        cell5.innerHTML = "Bentonit"
                                    }
                                }
                            }
                        }
                        else {
                            cell2.rowSpan = (endsum - startsum);
                            cell4.rowSpan = (endsum - startsum);
                            if (twofilters == "true") {
                                cell6.rowSpan = (endsum - startsum);
                            }
                            if (startsum + 2 > endofpipe1) {
                                cell3.rowSpan = (endsum - startsum);
                                if ((startsum + 1) == endofpipe1 && document.getElementById("cell_" + endofpipe1 + "_" + 3).className == "Blind") {
                                }
                                else {
                                    cell3.setAttribute('class', 'Bentonite');
                                    cell3.innerHTML = "Bentonit";
                                }
                            }
                            if (twofilters == "true") {
                                if (startsum + 2 > endofpipe2) {
                                    cell5.rowSpan = (endsum - startsum);
                                    if ((startsum + 1) == endofpipe2 && document.getElementById("cell_" + endofpipe2 + "_" + 3).className == "Blind") {
                                    }
                                    else {
                                        cell5.setAttribute('class', 'Bentonite');
                                        cell5.innerHTML = "Bentonit";
                                    }
                                }
                            }
                        }

                        cell2.setAttribute('class', 'Bentonite');
                        cell4.setAttribute('class', 'Bentonite');
                        if (twofilters == "true") {
                            cell6.setAttribute('class', 'Bentonite');
                            cell6.innerHTML = "Bentonit";
                        }
                        cell2.innerHTML = "Bentonit";
                        cell4.innerHTML = "Bentonit";
                        $("#Bentonite_CellStart_" + i).val(+cell2.id.split("_")[1]);
                        $("#Bentonite_CellEnd_" + i).val(+cell2.id.split("_")[1] + cell2.rowSpan - 1);
                    }
                    else { //under > over
                        if (over > 0) {
                            for (j = 1; j < Bentoniteoverlayerid; j++) {
                                startsum += +$("#Percent_" + j).val();
                            }
                            startsum -= 1;
                        }
                        else {
                            for (j = 1; j <= Bentoniteoverlayerid; j++) {
                                startsum += +$("#Percent_" + j).val();
                            }
                        }
                        if (under > 0) {
                            for (j = 1; j <= Bentoniteunderlayerid; j++) {
                                endsum += +$("#Percent_" + j).val();
                            }
                            endsum += 1;
                        }
                        else {
                            for (j = 1; j <= Bentoniteunderlayerid; j++) {
                                endsum += +$("#Percent_" + j).val();
                            }
                        }
                        if (startsum < 1) { //in case nothing is there.
                            startsum += 1;
                        }
                        if (under > 0) { //create arrows on gravel
                            addingunder = true;
                            cell22 = document.getElementById("cell_" + endsum + "_" + 2);
                            cell44 = document.getElementById("cell_" + endsum + "_" + 4);
                            if (twofilters == "true") {
                                cell66 = document.getElementById("cell_" + endsum + "_" + 6);
                                cell66.innerHTML = under + " m";
                                cell66.setAttribute('class', 'BentoniteA');
                            }
                            cell22.innerHTML = under + " m";
                            cell44.innerHTML = under + " m";
                            cell22.setAttribute('class', 'BentoniteA');
                            cell44.setAttribute('class', 'BentoniteA');
                        }
                        if (over > 0) {
                            addingover = true;
                            startsum += 1;
                            cell221 = document.getElementById("cell_" + startsum + "_" + 2);
                            cell441 = document.getElementById("cell_" + startsum + "_" + 4);
                            if (twofilters == "true") {
                                cell661 = document.getElementById("cell_" + startsum + "_" + 6);
                                cell661.innerHTML = over + " m";
                                cell661.setAttribute('class', 'BentoniteA');
                            }
                            cell221.innerHTML = over + " m";
                            cell441.innerHTML = over + " m";
                            cell221.setAttribute('class', 'BentoniteA');
                            cell441.setAttribute('class', 'BentoniteA');
                        }
                        if (under > 0) {
                            for (k = (startsum + 2); k <= endsum - 1; k++) {
                                if (startsum + 2 > endofpipe1) {
                                    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                                    celltoremove3.parentNode.removeChild(celltoremove3);
                                }
                                if (twofilters == "true") {
                                    if (startsum + 2 > endofpipe2) {
                                        celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                                        celltoremove5.parentNode.removeChild(celltoremove5);
                                    }
                                    celltoremove6 = document.getElementById("cell_" + k + "_" + 6);
                                    celltoremove6.parentNode.removeChild(celltoremove6);
                                }
                                celltoremove2 = document.getElementById("cell_" + k + "_" + 2);
                                celltoremove4 = document.getElementById("cell_" + k + "_" + 4);
                                celltoremove2.parentNode.removeChild(celltoremove2);
                                celltoremove4.parentNode.removeChild(celltoremove4);
                            }

                        }
                        else {
                            for (k = startsum + 2; k <= endsum; k++) {
                                if (startsum + 2 > endofpipe1) {
                                    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                                    celltoremove3.parentNode.removeChild(celltoremove3);
                                }
                                if (twofilters == "true") {
                                    if (startsum + 2 > endofpipe2) {
                                        celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                                        celltoremove5.parentNode.removeChild(celltoremove5);
                                    }
                                    celltoremove6 = document.getElementById("cell_" + k + "_" + 6);
                                    celltoremove6.parentNode.removeChild(celltoremove6);
                                }
                                celltoremove2 = document.getElementById("cell_" + k + "_" + 2);
                                celltoremove4 = document.getElementById("cell_" + k + "_" + 4);

                                celltoremove2.parentNode.removeChild(celltoremove2);
                                celltoremove4.parentNode.removeChild(celltoremove4);

                            }
                        }
                        cell2 = document.getElementById("cell_" + (startsum + 1) + "_" + 2);
                        cell4 = document.getElementById("cell_" + (startsum + 1) + "_" + 4);
                        if (twofilters == "true") {
                            cell6 = document.getElementById("cell_" + (startsum + 1) + "_" + 6);
                        }
                        if ((startsum + 1) == endofpipe1 && document.getElementById("cell_" + endofpipe1 + "_" + 3).className == "Blind") {

                            cell3 = document.getElementById("cell_" + (startsum + 1) + "_" + 3);
                            cell3.rowSpan = (endsum - startsum - 1);
                            cell3.setAttribute('class', 'Blind');
                            cell3.innerHTML = $("#BlindPipe1m").val() + " m";
                        }
                        else if (startsum + 2 > endofpipe1) { //this is new instead of commented out below

                            cell3 = document.getElementById("cell_" + (startsum + 1) + "_" + 3);
                        }
                        if (twofilters == "true") {
                            if ((startsum + 1) == endofpipe2 && document.getElementById("cell_" + endofpipe2 + "_" + 5).className == "Blind") {

                                cell5 = document.getElementById("cell_" + (startsum + 1) + "_" + 5);
                                cell5.rowSpan = (endsum - startsum - 1);
                                cell5.setAttribute('class', 'Blind');
                                cell5.innerHTML = $("#BlindPipe2m").val() + " m";
                            }
                            else if (startsum + 2 > endofpipe2) {
                                cell5 = document.getElementById("cell_" + (startsum + 1) + "_" + 5);
                                cell5.rowSpan = (endsum - startsum - 1);
                                cell5.setAttribute('class', 'Bentonite');
                                cell5.innerHTML = "Bentonit";
                            }
                        }
                        if (under > 0) {
                            cell2.rowSpan = (endsum - startsum - 1);
                            cell4.rowSpan = (endsum - startsum - 1);
                            if (twofilters == "true") {
                                cell6.rowSpan = (endsum - startsum - 1);
                            }
                            if (startsum + 2 > endofpipe1) {
                                cell3.rowSpan = (endsum - startsum - 1);
                                if ((startsum + 1) == endofpipe1 && document.getElementById("cell_" + endofpipe1 + "_" + 3).className == "Blind") {
                                }
                                else {
                                    cell3.setAttribute('class', 'Bentonite');
                                    cell3.innerHTML = "Bentonit"
                                    cell3under = document.getElementById("cell_" + endsum + "_" + 3);
                                    cell3under.rowSpan = 1;
                                    cell3under.setAttribute('class', 'BentoniteA');
                                    cell3under.innerHTML = under + " m";
                                    if (over > 0) {
                                        cell3over = document.getElementById("cell_" + startsum + "_" + 3);
                                        cell3over.rowSpan = 1;
                                        cell3over.setAttribute('class', 'BentoniteA');
                                        cell3over.innerHTML = over + " m";
                                    }
                                }
                            }
                            if (twofilters == "true") {
                                if (startsum + 2 > endofpipe2) {
                                    cell5.rowSpan = (endsum - startsum - 1);
                                    if ((startsum + 1) == endofpipe2 && document.getElementById("cell_" + endofpipe2 + "_" + 3).className == "Blind") {
                                    }
                                    else {
                                        cell5.setAttribute('class', 'Bentonite');
                                        cell5.innerHTML = "Bentonit"
                                        cell5under = document.getElementById("cell_" + endsum + "_" + 5);
                                        cell5under.rowSpan = 1;
                                        cell5under.setAttribute('class', 'BentoniteA');
                                        cell5under.innerHTML = under + " m";
                                        if (over > 0) {
                                            cell5over = document.getElementById("cell_" + (startsum) + "_" + 5);
                                            cell5over.rowSpan = 1;
                                            cell5over.setAttribute('class', 'BentoniteA');
                                            cell5over.innerHTML = over + " m";
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            cell2.rowSpan = (endsum - startsum);
                            cell4.rowSpan = (endsum - startsum);
                            if (twofilters == "true") {
                                cell6.rowSpan = (endsum - startsum);
                            }
                            if (startsum + 2 > endofpipe1) {
                                cell3.rowSpan = (endsum - startsum);
                                if ((startsum + 1) == endofpipe1 && document.getElementById("cell_" + endofpipe1 + "_" + 3).className == "Blind") {
                                }
                                else {
                                    cell3.setAttribute('class', 'Bentonite');
                                    cell3.innerHTML = "Bentonit";
                                    if (over > 0) {
                                        cell3over = document.getElementById("cell_" + startsum + "_" + 3);
                                        cell3over.rowSpan = 1;
                                        cell3over.setAttribute('class', 'BentoniteA');
                                        cell3over.innerHTML = over + " m";
                                    }
                                }
                            }
                            if (twofilters == "true") {
                                if (startsum + 2 > endofpipe2) {
                                    cell5.rowSpan = (endsum - startsum);
                                    if ((startsum + 1) == endofpipe2 && document.getElementById("cell_" + endofpipe2 + "_" + 3).className == "Blind") {
                                    }
                                    else {
                                        cell5.setAttribute('class', 'Bentonite');
                                        cell5.innerHTML = "Bentonit";
                                        if (over > 0) {
                                            cell5over = document.getElementById("cell_" + (startsum) + "_" + 5);
                                            cell5over.rowSpan = 1;
                                            cell5over.setAttribute('class', 'BentoniteA');
                                            cell5over.innerHTML = over + " m";
                                        }
                                    }
                                }
                            }
                        }


                        cell2.setAttribute('class', 'Bentonite');
                        cell4.setAttribute('class', 'Bentonite');
                        if (twofilters == "true") {
                            cell6.setAttribute('class', 'Bentonite');
                            cell6.innerHTML = "Bentonit";
                        }
                        cell2.innerHTML = "Bentonit";
                        cell4.innerHTML = "Bentonit";
                        $("#Bentonite_CellStart_" + i).val(+cell2.id.split("_")[1]);
                        $("#Bentonite_CellEnd_" + i).val(+cell2.id.split("_")[1] + cell2.rowSpan - 1);

                    }
                }

            }
        }

        function getOffset(theid) {
            var lengthlayer = +$("#Percent_" + theid).val();
            if (lengthlayer <= 4) {
                return 0;
            }
            else if (lengthlayer <= 8) {
                return 1;
            }
            else if (lengthlayer <= 12) {
                return 2;
            }
            else if (lengthlayer <= 18) {
                return 3;
            }
            else if (lengthlayer <= 26) {
                return 4;
            }
            else {
                return 5;
            }
        }
        function BuildFilter1() {
            endofpipe1 = 0;
            for (i = 1; i <= filtercount; i++)
            {
                var under = +$("#Filter1mUnder_" + i).val();
                var over = +$("#Filter1mOver_" + i).val();
                var laengde = +$("#Filter1m_" + i).val();
                var offset = 0;
                var offset1 = 0;
                var offset2 = 0;
                var Bentoniteunderlayerid = $("#Filter1Under_" + i + " option:selected").val();
                var Bentoniteoverlayerid = $("#Filter1Over_" + i + " option:selected").val();
                var startsum = 0;
                var endsum = 0;
                if (Bentoniteunderlayerid != "" && Bentoniteoverlayerid != "" && Bentoniteunderlayerid == Bentoniteoverlayerid) {
                    if (laengde >= 0) {
                        offset = getOffset(Bentoniteunderlayerid);
                        for (j = 1; j < Bentoniteunderlayerid; j++) {
                            startsum += +$("#Percent_" + j).val();
                        }
                        for (j = 1; j <= Bentoniteoverlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        startsum = startsum + (2 + offset);
                        endsum = endsum - (1 + offset);
                        endofpipe1 = endsum;
                    }
                    if (startsum != 0) {
                        for (k = startsum + 1; k <= endsum; k++) {
                            celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                            celltoremove3.parentNode.removeChild(celltoremove3);
                        }
                        cell3 = document.getElementById("cell_" + startsum + "_" + 3);
                        cell3.rowSpan = (endsum - startsum + 1);
                        cell3.innerHTML = laengde + " m";
                        cell3.setAttribute('class', 'ArrowF');
                        $("#Filter1_CellStart_" + i).val(+cell3.id.split("_")[1]);
                        $("#Filter1_CellEnd_" + i).val(+cell3.id.split("_")[1] + cell3.rowSpan - 1);
                    }
                }
                else if (Bentoniteunderlayerid != "" && Bentoniteoverlayerid != "") {
                    var underindex = +$("#Filter1Under_" + i + " option:selected").index();
                    var overindex = +$("#Filter1Over_" + i + " option:selected").index();
                    if (overindex > underindex) {
                        for (j = 1; j <= Bentoniteunderlayerid; j++) {
                            startsum += +$("#Percent_" + j).val();
                        }
                        for (j = 1; j < Bentoniteoverlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        startsum = startsum + 1;
                        if (under > 0) {
                            startsum = startsum + 1;
                            var currentindex = +$("#Filter1Under_" + i + " option:selected").index();
                            var nextindex = currentindex + 1;
                            var nextid = $("#Filter1Under_" + i + " option").eq(nextindex).val();
                            offset1 = getOffset(nextid);

                        }
                        if (over > 0) {
                            endsum = endsum - 1;
                            var currentindex = +$("#Filter1Over_" + i + " option:selected").index();
                            var beforeindex = currentindex - 1;
                            var beforeid = $("#Filter1Over_" + i + " option").eq(beforeindex).val();
                            offset2 = getOffset(beforeid);

                        }
                        startsum = startsum + offset1;
                        endsum = endsum - offset2;
                        endofpipe1 = endsum;
                        if (offset1 > 0) {
                            for (k = startsum - offset1; k < startsum; k++) {
                                celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                                celltoremove3.parentNode.removeChild(celltoremove3);
                            }
                            cell1x = document.getElementById("cell_" + (startsum - 1 - offset1) + "_" + 3)
                            cell1x.rowSpan = (offset1 + 1)
                            cell1x.innerHTML = under + " m";
                            cell1x.setAttribute('class', 'ArrowP'); //This is new
                        }

                        for (k = startsum + 1; k <= endsum; k++) {
                            celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                            celltoremove3.parentNode.removeChild(celltoremove3);
                        }
                        cell3 = document.getElementById("cell_" + startsum + "_" + 3);
                        cell3.rowSpan = (endsum - startsum + 1);
                        cell3.innerHTML = laengde + " m";
                        cell3.setAttribute('class', 'ArrowF');
                        $("#Filter1_CellStart_" + i).val(+cell3.id.split("_")[1]);
                        $("#Filter1_CellEnd_" + i).val(+cell3.id.split("_")[1] + cell3.rowSpan - 1);
                        if (offset2 > 0) {
                            for (k = endsum + 2; k <= endsum + offset2 + 1; k++) {
                                celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                                celltoremove3.parentNode.removeChild(celltoremove3);
                            }
                            cell2x = document.getElementById("cell_" + (endsum + offset + 1) + "_" + 3)
                            cell2x.rowSpan = (offset2 + 1)
                            cell2x.innerHTML = over + " m";
                            cell2x.setAttribute('class', 'GrusA');
                        }
                    }
                    else {
                        for (j = 1; j < Bentoniteoverlayerid; j++) {
                            startsum += +$("#Percent_" + j).val();
                        }
                        for (j = 1; j <= Bentoniteunderlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        startsum = startsum + 1;
                        if (under > 0) {
                            endsum = endsum + 1;
                            var currentindex = +$("#Filter1Under_" + i + " option:selected").index();
                            var nextindex = currentindex + 1;
                            var nextid = $("#Filter1Under_" + i + " option").eq(nextindex).val();
                            offset1 = getOffset(nextid);

                        }
                        if (over > 0) {
                            startsum = startsum - 1;
                            var currentindex = +$("#Filter1Over_" + i + " option:selected").index();
                            var beforeindex = currentindex - 1;
                            var beforeid = $("#Filter1Over_" + i + " option").eq(beforeindex).val();
                            offset2 = getOffset(beforeid);

                        }
                        endofpipe1 = endsum;
                        //offset1 = 1;
                        if (offset2 > 0) {

                            cell1x = document.getElementById("cell_" + (startsum) + "_" + 3)
                            //cell1x.rowSpan = (offset2 + 1)
                            cell1x.innerHTML = over + " m";
                            cell1x.setAttribute('class', 'ArrowF');
                        }

                        for (k = startsum + 2; k <= endsum - 1; k++) {
                            celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                            celltoremove3.parentNode.removeChild(celltoremove3);
                        }
                        cell3 = document.getElementById("cell_" + (startsum + 1) + "_" + 3);
                        cell3.rowSpan = (endsum - startsum - 1);
                        cell3.innerHTML = "X m";
                        cell3.setAttribute('class', 'ArrowF');
                        $("#Filter1_CellStart_" + i).val(+cell3.id.split("_")[1]);
                        $("#Filter1_CellEnd_" + i).val(+cell3.id.split("_")[1] + cell3.rowSpan - 1);
                        if (offset1 > 0) {
                            //for (k = endsum + 1; k <= endsum + offset1; k++) {
                            //    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                            //    celltoremove3.parentNode.removeChild(celltoremove3);
                            //}
                            cell2x = document.getElementById("cell_" + (endsum) + "_" + 3)
                            cell2x.rowSpan = 1;//(offset1 + 1)
                            cell2x.innerHTML = under + " m";
                            cell2x.setAttribute('class', 'ArrowF');
                        }
                        endofpipe1 = endsum; // + offset1;
                    }

                }
                else if (Bentoniteunderlayerid != "") {
                    for (j = 1; j <= Bentoniteunderlayerid; j++) {
                        startsum += +$("#Percent_" + j).val();
                    }

                    if (under > 0) {
                        startsum = startsum + 2;
                        var currentindex = +$("#Filter1Under_" + i + " option:selected").index();
                        var nextindex = currentindex + 1;
                        var nextid = $("#Filter1Under_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    else {
                        startsum = startsum + 1;
                        var currentindex = +$("#Filter1Under_" + i + " option:selected").index();
                        var nextindex = currentindex + 1;
                        var nextid = $("#Filter1Under_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    endsum = startsum + offset1 + 1;
                    endofpipe1 = endsum;
                    for (k = startsum + 1; k <= endsum; k++) {
                        celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                        celltoremove3.parentNode.removeChild(celltoremove3);
                    }
                    if (under > 0) {
                        cell3x = document.getElementById("cell_" + (startsum - 1) + "_" + 3);
                        cell3x.innerHTML = under + " m";
                        cell3x.setAttribute('class', 'ArrowP');
                    }
                    cell3 = document.getElementById("cell_" + startsum + "_" + 3);
                    cell3.rowSpan = (endsum - startsum + 1);
                    cell3.innerHTML = laengde + " m";
                    cell3.setAttribute('class', 'ArrowF');
                    $("#Filter1_CellStart_" + i).val(+cell3.id.split("_")[1]);
                    $("#Filter1_CellEnd_" + i).val(+cell3.id.split("_")[1] + cell3.rowSpan - 1);
                }
                else if (Bentoniteoverlayerid != "") {
                    for (j = 1; j <= Bentoniteoverlayerid; j++) {
                        endsum += +$("#Percent_" + j).val();
                    }

                    if (over > 0) {
                        endsum = endsum - 2;
                        var currentindex = +$("#Filter1Over_" + i + " option:selected").index();
                        var nextindex = currentindex - 1;
                        var nextid = $("#Filter1Over_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    else {
                        endsum = endsum - 1;
                        var currentindex = +$("#Filter1Over_" + i + " option:selected").index();
                        var nextindex = currentindex - 1;
                        var nextid = $("#Filter1Over_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    if (over > 0) {
                        startsum = endsum - offset1 - 1;
                    }
                    else {
                        startsum = endsum - offset1;
                    }
                    endofpipe1 = endsum;
                    if (over > 0) {
                        cell3x = document.getElementById("cell_" + (endsum + 1) + "_" + 3);
                        cell3x.innerHTML = over + " m";
                        cell3x.setAttribute('class', 'ArrowP');
                    }

                    for (k = startsum + 1; k <= endsum; k++) {
                        celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                        celltoremove3.parentNode.removeChild(celltoremove3);
                    }
                    cell3 = document.getElementById("cell_" + (startsum) + "_" + 3);
                    cell3.rowSpan = (endsum - startsum + 1);
                    cell3.innerHTML = laengde + " m";
                    cell3.setAttribute('class', 'ArrowF');
                    $("#Filter1_CellStart_" + i).val(+cell3.id.split("_")[1]);
                    $("#Filter1_CellEnd_" + i).val(+cell3.id.split("_")[1] + cell3.rowSpan - 1);
                }
            }

            if ($("#BlindPipe1").prop('checked') == true) {
                var currentindex = +$("#Filter1Under_1 option:selected").index();
                var overindex = +$("#Filter1Over_1 option:selected").index();
                if (currentindex < overindex) {
                    currentindex = overindex;
                }
                var offsetblind = getOffset(currentindex);
                //alert(offsetblind);
                for (k = endofpipe1 + 2; k <= (endofpipe1 + offsetblind); k++) {
                    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                    celltoremove3.parentNode.removeChild(celltoremove3);
                }
                cell3 = document.getElementById("cell_" + (endofpipe1 + 1) + "_" + 3);
                //cell3.rowSpan = (offsetblind - 1);
                cell3.rowSpan = 1;//offsetblind;
                cell3.innerHTML = $("#BlindPipe1m").val() + " m";
                cell3.setAttribute('class', 'Blind');
                endofpipe1 = endofpipe1 + 1;//+ offsetblind;
            }
        }
        function BuildFilter2() {
            endofpipe2 = 0;
            for (i = 1; i <= filtercount; i++) {
                var under = +$("#Filter2mUnder_" + i).val();
                var over = +$("#Filter2mOver_" + i).val();
                var laengde = +$("#Filter2m_" + i).val();
                var offset = 0;
                var offset1 = 0;
                var offset2 = 0;
                var Bentoniteunderlayerid = $("#Filter2Under_" + i + " option:selected").val();
                var Bentoniteoverlayerid = $("#Filter2Over_" + i + " option:selected").val();
                var startsum = 0;
                var endsum = 0;
                if (Bentoniteunderlayerid != "" && Bentoniteoverlayerid != "" && Bentoniteunderlayerid == Bentoniteoverlayerid) {
                    if (laengde >= 0) {
                        offset = getOffset(Bentoniteunderlayerid);
                        for (j = 1; j < Bentoniteunderlayerid; j++) {
                            startsum += +$("#Percent_" + j).val();
                        }
                        for (j = 1; j <= Bentoniteoverlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        startsum = startsum + (2 + offset);
                        endsum = endsum - (1 + offset);
                        endofpipe2 = endsum;
                    }
                    if (startsum != 0) {
                        for (k = startsum + 1; k <= endsum; k++) {
                            celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                            celltoremove5.parentNode.removeChild(celltoremove5);
                        }
                        cell5 = document.getElementById("cell_" + startsum + "_" + 5);
                        cell5.rowSpan = (endsum - startsum + 1);
                        cell5.innerHTML = laengde + " m";
                        cell5.setAttribute('class', 'ArrowF');
                        $("#Filter2_CellStart_" + i).val(+cell5.id.split("_")[1]);
                        $("#Filter2_CellEnd_" + i).val(+cell5.id.split("_")[1] + cell5.rowSpan - 1);
                    }
                }
                else if (Bentoniteunderlayerid != "" && Bentoniteoverlayerid != "") {
                    var underindex = +$("#Filter2Under_" + i + " option:selected").index();
                    var overindex = +$("#Filter2Over_" + i + " option:selected").index();
                    if (overindex > underindex) {
                        for (j = 1; j <= Bentoniteunderlayerid; j++) {
                            startsum += +$("#Percent_" + j).val();
                        }
                        for (j = 1; j < Bentoniteoverlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        startsum = startsum + 1;
                        if (under > 0) {
                            startsum = startsum + 1;
                            var currentindex = +$("#Filter2Under_" + i + " option:selected").index();
                            var nextindex = currentindex + 1;
                            var nextid = $("#Filter2Under_" + i + " option").eq(nextindex).val();
                            offset1 = getOffset(nextid);

                        }
                        if (over > 0) {
                            endsum = endsum - 1;
                            var currentindex = +$("#Filter2Over_" + i + " option:selected").index();
                            var beforeindex = currentindex - 1;
                            var beforeid = $("#Filter2Over_" + i + " option").eq(beforeindex).val();
                            offset2 = getOffset(beforeid);

                        }
                        startsum = startsum + offset1;
                        endsum = endsum - offset2;
                        endofpipe2 = endsum;
                        if (offset1 > 0) {
                            for (k = startsum - offset1; k < startsum; k++) {
                                celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                                celltoremove5.parentNode.removeChild(celltoremove5);
                            }
                            cell1x = document.getElementById("cell_" + (startsum - 1 - offset1) + "_" + 5)
                            cell1x.rowSpan = (offset1 + 1)
                            cell1x.innerHTML = under + " m";
                            cell1x.setAttribute('class', 'ArrowP'); //This is new
                        }

                        for (k = startsum + 1; k <= endsum; k++) {
                            celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                            celltoremove5.parentNode.removeChild(celltoremove5);
                        }
                        cell5 = document.getElementById("cell_" + startsum + "_" + 5);
                        cell5.rowSpan = (endsum - startsum + 1);
                        cell5.innerHTML = laengde + " m";
                        cell5.setAttribute('class', 'ArrowF');
                        $("#Filter2_CellStart_" + i).val(+cell5.id.split("_")[1]);
                        $("#Filter2_CellEnd_" + i).val(+cell5.id.split("_")[1] + cell5.rowSpan - 1);
                        if (offset2 > 0) {
                            for (k = endsum + 2; k <= endsum + offset2 + 1; k++) {
                                celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                                celltoremove5.parentNode.removeChild(celltoremove5);
                            }
                            cell2x = document.getElementById("cell_" + (endsum + offset + 1) + "_" + 5)
                            cell2x.rowSpan = (offset2 + 1)
                            cell2x.innerHTML = over + " m";
                            cell2x.setAttribute('class', 'GrusA');
                        }
                    }
                    else {
                        for (j = 1; j < Bentoniteoverlayerid; j++) {
                            startsum += +$("#Percent_" + j).val();
                        }
                        for (j = 1; j <= Bentoniteunderlayerid; j++) {
                            endsum += +$("#Percent_" + j).val();
                        }
                        startsum = startsum + 1;
                        if (under > 0) {
                            endsum = endsum + 1;
                            var currentindex = +$("#Filter2Under_" + i + " option:selected").index();
                            var nextindex = currentindex + 1;
                            var nextid = $("#Filter2Under_" + i + " option").eq(nextindex).val();
                            offset1 = getOffset(nextid);

                        }
                        if (over > 0) {
                            startsum = startsum - 1;
                            var currentindex = +$("#Filter2Over_" + i + " option:selected").index();
                            var beforeindex = currentindex - 1;
                            var beforeid = $("#Filter2Over_" + i + " option").eq(beforeindex).val();
                            offset2 = getOffset(beforeid);

                        }
                        endofpipe2 = endsum;
                        if (offset2 > 0) {

                            cell1x = document.getElementById("cell_" + (startsum) + "_" + 5)
                            //cell1x.rowSpan = (offset2 + 1)
                            cell1x.innerHTML = over + " m";
                            cell1x.setAttribute('class', 'ArrowF');
                        }

                        for (k = startsum + 2; k <= endsum - 1; k++) {
                            celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                            celltoremove5.parentNode.removeChild(celltoremove5);
                        }
                        cell5 = document.getElementById("cell_" + (startsum + 1) + "_" + 5);
                        cell5.rowSpan = (endsum - startsum - 1);
                        cell5.innerHTML = "X m";
                        cell5.setAttribute('class', 'ArrowF');
                        $("#Filter2_CellStart_" + i).val(+cell5.id.split("_")[1]);
                        $("#Filter2_CellEnd_" + i).val(+cell5.id.split("_")[1] + cell5.rowSpan - 1);
                        if (offset1 > 0) {
                            cell2x = document.getElementById("cell_" + (endsum) + "_" + 5)
                            cell2x.rowSpan = 1;//(offset1 + 1)
                            cell2x.innerHTML = under + " m";
                            cell2x.setAttribute('class', 'ArrowF');
                        }
                        endofpipe2 = endsum; // + offset1;
                    }

                }
                else if (Bentoniteunderlayerid != "") {
                    for (j = 1; j <= Bentoniteunderlayerid; j++) {
                        startsum += +$("#Percent_" + j).val();
                    }

                    if (under > 0) {
                        startsum = startsum + 2;
                        var currentindex = +$("#Filter2Under_" + i + " option:selected").index();
                        var nextindex = currentindex + 1;
                        var nextid = $("#Filter2Under_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    else {
                        startsum = startsum + 1;
                        var currentindex = +$("#Filter2Under_" + i + " option:selected").index();
                        var nextindex = currentindex + 1;
                        var nextid = $("#Filter2Under_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    endsum = startsum + offset1 + 1;
                    endofpipe2 = endsum;
                    for (k = startsum + 1; k <= endsum; k++) {
                        celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                        celltoremove5.parentNode.removeChild(celltoremove5);
                    }
                    if (under > 0) {
                        cell5x = document.getElementById("cell_" + (startsum - 1) + "_" + 5);
                        cell5x.innerHTML = under + " m";
                        cell5x.setAttribute('class', 'ArrowP');
                    }
                    cell5 = document.getElementById("cell_" + startsum + "_" + 5);
                    cell5.rowSpan = (endsum - startsum + 1);
                    cell5.innerHTML = laengde + " m";
                    cell5.setAttribute('class', 'ArrowF');
                    $("#Filter2_CellStart_" + i).val(+cell5.id.split("_")[1]);
                    $("#Filter2_CellEnd_" + i).val(+cell5.id.split("_")[1] + cell5.rowSpan - 1);
                }
                else if (Bentoniteoverlayerid != "") {
                    for (j = 1; j <= Bentoniteoverlayerid; j++) {
                        endsum += +$("#Percent_" + j).val();
                    }

                    if (over > 0) {
                        endsum = endsum - 2;
                        var currentindex = +$("#Filter2Over_" + i + " option:selected").index();
                        var nextindex = currentindex - 1;
                        var nextid = $("#Filter2Over_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    else {
                        endsum = endsum - 1;
                        var currentindex = +$("#Filter2Over_" + i + " option:selected").index();
                        var nextindex = currentindex - 1;
                        var nextid = $("#Filter2Over_" + i + " option").eq(nextindex).val();
                        offset1 = getOffset(nextid);
                        offset1 = offset1 * 2;
                    }
                    if (over > 0) {
                        startsum = endsum - offset1 - 1;
                    }
                    else {
                        startsum = endsum - offset1;
                    }
                    endofpipe2 = endsum;
                    if (over > 0) {
                        cell5x = document.getElementById("cell_" + (endsum + 1) + "_" + 5);
                        cell5x.innerHTML = over + " m";
                        cell5x.setAttribute('class', 'ArrowP');
                    }

                    for (k = startsum + 1; k <= endsum; k++) {
                        celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                        celltoremove5.parentNode.removeChild(celltoremove5);
                    }
                    cell5 = document.getElementById("cell_" + (startsum) + "_" + 5);
                    cell5.rowSpan = (endsum - startsum + 1);
                    cell5.innerHTML = laengde + " m";
                    cell5.setAttribute('class', 'ArrowF');
                    $("#Filter2_CellStart_" + i).val(+cell5.id.split("_")[1]);
                    $("#Filter2_CellEnd_" + i).val(+cell5.id.split("_")[1] + cell5.rowSpan - 1);
                }
            }
            if ($("#BlindPipe2").prop('checked') == true) {
                var currentindex = +$("#Filter2Under_1 option:selected").index();
                var overindex = +$("#Filter2Over_1 option:selected").index();
                if (currentindex < overindex) {
                    currentindex = overindex;
                }
                var offsetblind = getOffset(currentindex);
                for (k = endofpipe2 + 2; k <= (endofpipe2 + offsetblind); k++) {
                    celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                    celltoremove5.parentNode.removeChild(celltoremove5);
                }
                cell5 = document.getElementById("cell_" + (endofpipe2 + 1) + "_" + 5);
                cell5.rowSpan = 1;//offsetblind;
                cell5.innerHTML = $("#BlindPipe2m").val() + " m";
                cell5.setAttribute('class', 'Blind');
                endofpipe2 = endofpipe2 + 1;//+ offsetblind;
            }
        }
        function AmmendLastLayer() {
            var sumpercent = 0;
            var lastvalid = 0;
            var lastmodified = 0;
            for (i = 1; i <= 10; i++) {
                if ($("#Layer_" + i).val() != "") {
                    lastvalid = i;
                    sumpercent += +$("#Percent_" + i).val();
                }
            }
            var toadd = +(100 - sumpercent);
            $("#Percent_" + lastvalid).val(+$("#Percent_" + lastvalid).val() + toadd);
            sumpercent = 0;
            for (i = 1; i <= 10; i++) {
                if ($("#Layer_" + i).val() != "" && $("#Percent_" + i).val() > 1) {
                    lastmodified = i;
                }
            }
            for (i = 1; i <= 10; i++) {
                if (+$("#Percent_" + i).val() <= 0) {
                    var tosubtract = +$("#Percent_" + i).val();
                    $("#Percent_" + i).val(1);
                    $("#Percent_" + lastmodified).val(+$("#Percent_" + lastmodified).val() + tosubtract);
                }
            }
            for (i = 1; i <= 10; i++) {
                if ($("#Layer_" + i).val() != "") {
                    sumpercent += +$("#Percent_" + i).val();
                }
            }
            var toadd = +(100 - sumpercent);
            $("#Percent_" + lastmodified).val(+$("#Percent_" + lastmodified).val() + toadd);
        }
        function UpdateBentoniteLayerList() {
            var s = '<option value="">Please Select Layer</option>';
            currentundervals = ["", "", "", "", "", "", "", "", "", ""];
            currentovervals = ["", "", "", "", "", "", "", "", "", ""];
            for (i = 1; i <= 10; i++) {
                currentundervals[i] = $("#BentoniteUnder_" + i).val();
                currentovervals[i] = $("#BentoniteOver_" + i).val();
                if ($("#Layer_" + i).val() != "") {
                    s += '<option value="' + i + '">' + $("#Layer_" + i + " option:selected").text() + '</option>';
                }
            }
            for (j = 1; j <= 10; j++) {
                $("#BentoniteUnder_" + j).html(s);
                $("#BentoniteOver_" + j).html(s);
                if (currentundervals[j] != "") {
                    var x = document.getElementById("BentoniteUnder_" + j);
                    for (i = 0; i < x.length; i++) {
                        if (x.options[i].value == currentundervals[j]) {
                            x.options[i].selected = true;
                        }
                    }
                }
                if (currentovervals[j] != "") {
                    var x = document.getElementById("BentoniteOver_" + j);
                    for (i = 0; i < x.length; i++) {
                        if (x.options[i].value == currentovervals[j]) {
                            x.options[i].selected = true;
                        }
                    }
                }
            }
        }
        function UpdateFilter1LayerList() {
            var s = '<option value="">Please Select Layer</option>';
            currentundervals = ["", "", ""];
            currentovervals = ["", "", ""];
            for (i = 1; i <= 10; i++) {
                if (i <= filtercount) {
                    currentundervals[i] = $("#Filter1Under_" + i).val();
                    currentovervals[i] = $("#Filter1Over_" + i).val();
                }

                if ($("#Layer_" + i).val() != "") {
                    s += '<option value="' + i + '">' + $("#Layer_" + i + " option:selected").text() + '</option>';
                }
            }
            for (j = 1; j <= filtercount; j++) {
                $("#Filter1Under_" + j).html(s);
                $("#Filter1Over_" + j).html(s);
                if (currentundervals[j] != "") {
                    var x = document.getElementById("Filter1Under_" + j);
                    for (i = 0; i < x.length; i++) {
                        if (x.options[i].value == currentundervals[j]) {
                            x.options[i].selected = true;
                        }
                    }
                }
                if (currentovervals[j] != "") {
                    var x = document.getElementById("Filter1Over_" + j);
                    for (i = 0; i < x.length; i++) {
                        if (x.options[i].value == currentovervals[j]) {
                            x.options[i].selected = true;
                        }
                    }
                }
            }
        }
        function UpdateFilter2LayerList() {
            var s = '<option value="">Please Select Layer</option>';
            currentundervals = ["", "", ""];
            currentovervals = ["", "", ""];
            for (i = 1; i <= 10; i++) {
                if (i <= filtercount) {
                    currentundervals[i] = $("#Filter2Under_" + i).val();
                    currentovervals[i] = $("#Filter2Over_" + i).val();
                }
                if ($("#Layer_" + i).val() != "") {
                    s += '<option value="' + i + '">' + $("#Layer_" + i + " option:selected").text() + '</option>';
                }
            }
            for (j = 1; j <= filtercount; j++) {
                $("#Filter2Under_" + j).html(s);
                $("#Filter2Over_" + j).html(s);
                if (currentundervals[j] != "") {
                    var x = document.getElementById("Filter2Under_" + j);
                    for (i = 0; i < x.length; i++) {
                        if (x.options[i].value == currentundervals[j]) {
                            x.options[i].selected = true;
                        }
                    }
                }
                if (currentovervals[j] != "") {
                    var x = document.getElementById("Filter2Over_" + j);
                    for (i = 0; i < x.length; i++) {
                        if (x.options[i].value == currentovervals[j]) {
                            x.options[i].selected = true;
                        }
                    }
                }
            }
        }
        function PutColours() {
            var thetable = document.getElementById("myTable");
            thetable.style.borderCollapse = "unset";
            //var pipeelement = document.getElementById("cell_1_3");
            //pipeelement.style.borderCollapse = "collapse";
            //pipeelement.style.borderLeft = "2px solid red";
            var pipeElements = thetable.getElementsByClassName("Pipe");
            var i;
            for (i = 0; i < pipeElements.length; i++) {
                if (pipeElements[i] !== null) {
                    pipeElements[i].style.borderLeft = "2px solid red";
                    pipeElements[i].style.borderRight = "2px solid red";
                    pipeElements[i].style.borderTop = "none";
                    pipeElements[i].style.borderBottom = "none";
                }
            }
            var blindElements = thetable.getElementsByClassName("Blind");
            var urlstr = "/Images/LayerBackGroundImages/PipeArrow.jpg";
            for (i = 0; i < blindElements.length; i++) {
                if (blindElements[i] !== null) {
                    blindElements[i].style.borderLeft = "2px solid red";
                    blindElements[i].style.borderRight = "2px solid red";
                    blindElements[i].style.borderBottom = "2px solid red";
                    blindElements[i].style.textAlign = "center";
                    blindElements[i].style.color = "red";
                    blindElements[i].style.backgroundImage = "url(" + urlstr + ")";
                    blindElements[i].style.backgroundSize = "100% 100%";
                }
            }
            var bentoniteelements = document.getElementsByClassName("Bentonite");
            urlstr = "/Images/LayerBackGroundImages/Bentonit.jpg";
            for (i = 0; i < bentoniteelements.length; i++) {
                bentoniteelements[i].style.backgroundImage = "url(" + urlstr + ")";
                bentoniteelements[i].style.textAlign = "center";
                bentoniteelements[i].style.color = "black";
            }
            var bentoniteAelements = document.getElementsByClassName("BentoniteA");
            urlstr = "/Images/LayerBackGroundImages/BentoniteArrow.jpg";
            for (i = 0; i < bentoniteAelements.length; i++) {
                bentoniteAelements[i].style.backgroundImage = "url(" + urlstr + ")";
                bentoniteAelements[i].style.textAlign = "center";
                bentoniteAelements[i].style.backgroundSize = "100% 100%";
                bentoniteAelements[i].style.color = "red";
            }
            var layerelements = document.getElementsByClassName("Layer");
            for (i = 0; i < layerelements.length; i++) {
                layerelements[i].style.height = $("#Percent_" + i).val() + "%";
                    var layerid = layerelements[i].getAttribute('LayerId');
                    var urlstr = "/Images/LayerBackGroundImages/" + layerid + ".jpg";
                    layerelements[i].style.backgroundImage = "url(" + urlstr + ")";
                    layerelements[i].style.textAlign = "center";
                    layerelements[i].style.color = "red";
                /*}*/
            }
            var filterelements = document.getElementsByClassName("Filter");
            urlstr = "/Images/LayerBackGroundImages/Filter.jpg";
            for (i = 0; i < filterelements.length; i++) {
                filterelements[i].style.backgroundImage = "url(" + urlstr + ")";
            }
            var filterAelements = document.getElementsByClassName("ArrowF");
            urlstr = "/Images/LayerBackGroundImages/FilterARROW.jpg";
            for (i = 0; i < filterAelements.length; i++) {

                filterAelements[i].style.backgroundImage = "url(" + urlstr + ")";
                filterAelements[i].style.backgroundSize = "100% 100%";
                filterAelements[i].style.textAlign = "center";
                filterAelements[i].style.color = "red";
                filterAelements[i].style.borderBottom = "2px solid green";
                filterAelements[i].style.borderLeft = "2px solid green";
                filterAelements[i].style.borderRight = "2px solid green";
                filterAelements[i].style.borderTop = "2px solid green";
                //take care of removing borders inbetween filter elements by checking class above and under
                var theid = filterAelements[i].id;
                var row = +theid.split("_")[1];
                var col = +theid.split("_")[2];
                for (k = (row + 1); k <= 100; k++) {
                    var newcell = document.getElementById("cell_" + k + "_" + col);
                    if (newcell !== null) {
                        var classname = newcell.className;
                        if (classname == "ArrowF") {
                            filterAelements[i].style.borderBottom = "none";
                        }
                        break;
                    }
                }
                for (j = row - 1; j >= 1; j--) {

                    var newcell = document.getElementById("cell_" + j + "_" + col);
                    if (newcell !== null) {
                        var classname = newcell.className;
                        if (classname == "ArrowF") {
                            filterAelements[i].style.borderTop = "none";
                        }
                        break;
                    }
                }
            }
            var gruselements = document.getElementsByClassName("Grus");
            urlstr = "/Images/LayerBackGroundImages/Grus.jpg";
            for (i = 0; i < gruselements.length; i++) {
                gruselements[i].style.backgroundImage = "url(" + urlstr + ")";
            }
            var grusAelements = document.getElementsByClassName("GrusA");
            for (i = 0; i < grusAelements.length; i++) {
                grusAelements[i].style.backgroundImage = "url(" + urlstr + ")";
                //grusAelements[i].style.backgroundImage = "url('https://drive.google.com/u/0/uc?id=1whcitLgWXYGzgCv0E3cSXV5c4Q_lCc72&export=download'),url('https://drive.google.com/u/0/1a10QOI641zeMHS1yWMFx8RV54khE_LxQ&export=download')";
                grusAelements[i].style.backgroundSize = "100% 100%";
                grusAelements[i].style.textAlign = "center";
                grusAelements[i].style.color = "red";
            }
            var pipeAElements = document.getElementsByClassName("ArrowP");
            urlstr = "/Images/LayerBackGroundImages/PipeArrow.jpg";
            for (i = 0; i < pipeAElements.length; i++) {
                pipeAElements[i].style.backgroundImage = "url(" + urlstr + ")";
                pipeAElements[i].style.border = "2px solid red";
                pipeAElements[i].style.borderTop = "none";
                pipeAElements[i].style.borderBottom = "none";
                pipeAElements[i].style.backgroundSize = "100% 100%";
                pipeAElements[i].style.textAlign = "center";
                pipeAElements[i].style.color = "red";
            }


        }
        function MergeGrus() {
            for (j = 2; j <= 6; j++) {
                var start = 0;
                var end = 0;
                var running = false;
                var twofilters = $("#ToFiltre").val();
                for (i = 2; i < 100; i++) {
                    if (twofilters == "true" || (twofilters == "false" && (j == 2 || j == 3 || j == 4))) {
                        cell = document.getElementById("cell_" + i + "_" + j);
                        if (cell == null) {

                        }
                        else {
                            if (cell.innerHTML == "") {
                                if (running == false) {
                                    start = i;
                                    running = true;
                                }
                                end = i;
                            }
                            else
                            {
                                if (end > start && running == true) {
                                    for (k = start + 1; k <= end; k++) {
                                        celltoremove = document.getElementById("cell_" + k + "_" + j);
                                        celltoremove.parentNode.removeChild(celltoremove);
                                    }
                                    cellstart = document.getElementById("cell_" + start + "_" + j);
                                    cellstart.rowSpan = (end - start + 1);
                                    cellstart.innerHTML = "Grus";
                                    cellstart.style.textAlign = "center";
                                    cellstart.setAttribute('class', 'Grus');
                                    start = 0;
                                    end = 0;
                                    running = false;
                                }

                            }
                            if (i == 99 && cell.innerHTML == "") {
                                if (end > start && running == true) {
                                    for (k = start + 1; k <= end; k++) {
                                        celltoremove = document.getElementById("cell_" + k + "_" + j);
                                        celltoremove.parentNode.removeChild(celltoremove);
                                    }
                                    cellstart = document.getElementById("cell_" + start + "_" + j);
                                    cellstart.rowSpan = (end - start + 1);
                                    cellstart.innerHTML = "Grus";
                                    cellstart.style.textAlign = "center";
                                    cellstart.style.borderLeft = "none";
                                    cellstart.style.borderRight = "none";
                                    cellstart.setAttribute('class', 'Grus');
                                    start = 0;
                                    end = 0;
                                    running = false;
                                }
                            }
                        }
                    }
                }

            }
        }
        function CreatePipe1()        {
            var startpipe = 1;
            var stoppipe = 1;
            var therowspan = 0;
            for (i = 1; i <= endofpipe1; i++) {
                cell = document.getElementById("cell_" + i + "_" + 3);
                if (cell == null) {
                    therowspan = therowspan - 1;
                }
                else {
                    if (cell.classList.contains("Filter") || cell.classList.contains("ArrowF") || cell.classList.contains("ArrowP")) {
                        stoppipe = i - 1;
                        break;
                    }
                }
                therowspan = therowspan + 1;
            }
            if (stoppipe > 1) {
                for (k = startpipe + 1; k <= stoppipe; k++) {
                    celltoremove3 = document.getElementById("cell_" + k + "_" + 3);
                    celltoremove3.parentNode.removeChild(celltoremove3);
                }
                cellp = document.getElementById("cell_" + startpipe + "_" + 3);
                cellp.rowSpan = therowspan; //(stoppipe - startpipe + 1);
                cellp.innerHTML = $("#Filter1_Dim").val();
                cellp.style.textAlign = "center";
                cellp.setAttribute('class', 'Pipe');


            }

        }
        function CreatePipe2() {
            var startpipe = 1;
            var stoppipe = 1;
            for (i = 1; i <= endofpipe2; i++) {
                cell = document.getElementById("cell_" + i + "_" + 5);
                if (cell == null) {

                }
                else {
                    if (cell.classList.contains("Filter") || cell.classList.contains("ArrowF") || cell.classList.contains("ArrowP")) {
                        stoppipe = i - 1;
                        break;
                    }
                }
            }
            if (stoppipe > 1) {
                for (k = startpipe + 1; k <= stoppipe; k++) {
                    celltoremove5 = document.getElementById("cell_" + k + "_" + 5);
                    celltoremove5.parentNode.removeChild(celltoremove5);
                }
                cell5 = document.getElementById("cell_" + startpipe + "_" + 5);
                cell5.rowSpan = (stoppipe - startpipe + 1);
                cell5.innerHTML = $("#Filter2_Dim").val();
                cell5.style.textAlign = "center";
                cell5.setAttribute('class', 'Pipe');

            }

        }
        function UpdateF1Laengde() {
            var laengde = $("#Filter1_Laengde").val();
            $("#Filter1m_1").val(laengde);
        }
        function UpdateF2Laengde() {
            var laengde = $("#Filter2_Laengde").val();
            $("#Filter2m_1").val(laengde);
        }
        function InsertGravelAgain() {
            if ($("#BlindPipe1").prop('checked') == true) {
                row3start = 0;
                row3span = 0;
                for (i = 99; i > 0; i--) {
                    var lastcell3 = document.getElementById("cell_" + i + "_3")
                    if (lastcell3 != null) {
                        if (lastcell3.classList.contains("Blind"))
                        {
                            var resultingrow = lastcell3.rowSpan + i;
                            if (resultingrow != 99) {
                                row3start = i + 1;
                                row3span = 99 - row3start + 1;
                            }
                        }
                        break;

                    }
                }
                if (row3start != 0) {
                    var row3 = document.getElementById("row_" + row3start);
                    var cellX3 = document.getElementById("cell_" + row3start + "_3");
                    if (cellX3 == null) {
                        var over = +$("#Filter1mOver_1").val();
                        var c3 = row3.insertCell(0);
                        c3.id = "cell_" + row3start + "_3";
                        c3.rowSpan = row3span;
                        c3.setAttribute('class', 'GrusA');
                        c3.innerHTML = over + " m";
                    }
                }
            }
            if ($("#BlindPipe2").prop('checked') == true) {
                row5start = 0;
                row5span = 0;
                for (i = 99; i > 0; i--) {
                    var lastcell5 = document.getElementById("cell_" + i + "_5")
                    if (lastcell5 != null) {
                        if (lastcell5.classList.contains("Blind")) {
                            var resultingrow = lastcell5.rowSpan + i;
                            if (resultingrow != 99) {
                                row5start = i + 1;
                                row5span = 99 - row5start + 1;
                            }
                        }
                        break;

                    }
                }
                if (row5start != 0) {
                    var row5 = document.getElementById("row_" + row5start);
                    var cellX5 = document.getElementById("cell_" + row5start + "_5");
                    if (cellX5 == null) {
                        var over = +$("#Filter2mOver_1").val();
                        var c5 = row5.insertCell(0);
                        c5.id = "cell_" + row5start + "_5";
                        c5.rowSpan = row5span;
                        c5.setAttribute('class', 'GrusA');
                        c5.innerHTML = over + " m";
                    }
                }
            }
        }

    </script>
}
@model MainOps.Models.ReportClasses.InvoiceModel
@{
    ViewData["Title"] = "Basis for Invoice";
    var thevaluta = "";
    var firstitem = Model.allItems.Where(x => x.ItemTypeId != 0).FirstOrDefault();

    @if (firstitem != null)
    {
        if (firstitem.ItemType.Valuta.Equals("EURO"))
        {
            thevaluta = "€";
        }
        else
        {
            thevaluta = "DKK";
        }
    }
    else
    {
        var firstextraitem = Model.allItems.Where(x => x.ExtraWorkId != null).FirstOrDefault();
        if (firstextraitem != null)
        {
            thevaluta = firstextraitem.ExtraWork.Valuta;
        }
        else
        {
            thevaluta = "DKK";
        }

    }}
@if (Model.AllInvoicesSent.Equals(false)) { 
<span style="color:red;"><b><big><big><big><big>@SharedLocalizer.GetLocalizedHtmlString("PREVIOUS INVOICE(S) MISSING! Please") <a asp-action="Index" asp-controller="Invoices" asp-route-id="@Model.ProjectId">@SharedLocalizer.GetLocalizedHtmlString("CHECK!")</a></big></big></big></big></b></span>
}
<form asp-action="GetDocumentation" method="get" target="_blank">
    <input type="text" value="@String.Format("{0:yyyy-MM-dd}", Model.starttime)" name="starttime" hidden="hidden" />
    <input type="text" value="@String.Format("{0:yyyy-MM-dd}", Model.endtime)" name="endtime" hidden="hidden" />
    <input type="number" value="@Model.ProjectId" name="ProjectId" id="ProjectId" hidden="hidden" />
    <table style="width:100%">
        <tr>
            <td align="left"><h3><label>@SharedLocalizer.GetLocalizedHtmlString("Start:")</label></h3></td>
            <td align="right"><h3><label>@String.Format("{0:yyyy-MM-dd}", Model.starttime)</label></h3></td>
        </tr>
        <tr>
            <td align="left"><h3><label>@SharedLocalizer.GetLocalizedHtmlString("End:")</label></h3></td>
            <td align="right"><h3><label>@String.Format("{0:yyyy-MM-dd}", Model.endtime)</label></h3></td>
        </tr>
        <tr>
            <td align="left"><h3><label>@SharedLocalizer.GetLocalizedHtmlString("Project:")</label></h3></td>
            <td align="right"><h3><label>@Model.Project.Name</label></h3></td>
        </tr>
        @if (Model.SubProjectId != null)
        {
            <tr>
                <td align="left"><h3><label>@SharedLocalizer.GetLocalizedHtmlString("Sub Project:")</label></h3></td>
                <td align="right"><h3><label>@Model.SubProject.Name</label></h3></td>
            </tr>
        }
        <tr>
            <td colspan="2"><button type="submit" class="btn-hoelscher">@SharedLocalizer.GetLocalizedHtmlString("Download Documentation")</button></td>
        </tr>
    </table>
</form>

    <form asp-action="GetInvoice" method="get" target="_blank">
        <input type="text" value="@String.Format("{0:yyyy-MM-dd}", Model.starttime)" name="starttime" hidden="hidden" />
        <input type="text" value="@String.Format("{0:yyyy-MM-dd}", Model.endtime)" name="endtime" hidden="hidden" />
        <input value="@Model.ProjectId" name="ProjectId" id="ProjectId" hidden="hidden" />
        <table>
            <tr>
                <td>
                    <button type="submit" class="btn-hoelscher">@SharedLocalizer.GetLocalizedHtmlString("Download Invoice")</button>
                </td>
            </tr>
        </table>
    </form>

    <form asp-action="GetInvoiceExcel" method="get" target="_blank">
        <input type="text" value="@String.Format("{0:yyyy-MM-dd}", Model.starttime)" name="starttime" hidden="hidden" />
        <input type="text" value="@String.Format("{0:yyyy-MM-dd}", Model.endtime)" name="endtime" hidden="hidden" />
        <input value="@Model.ProjectId" name="ProjectId" id="ProjectId" hidden="hidden" />
        <table>
            <tr>
                <td>
                    <button type="submit" class="btn-hoelscher">@SharedLocalizer.GetLocalizedHtmlString("Download Invoice Excel")</button>
                </td>
            </tr>
        </table>
    </form>

        <form asp-action="GetInvoiceZipFile" method="get" target="_blank">
            <input value="@Model.ProjectId" name="ProjectId" id="ProjectId" hidden="hidden" />
            <table>
                <tr>
                    <td>
                        <button type="submit" class="btn-hoelscher">@SharedLocalizer.GetLocalizedHtmlString("Download All Files in ZIP")</button>
                    </td>
                </tr>
            </table>
        </form>
    
    <br />
    @{ var totaltotalcost = (decimal)0.0;
        var numRecords = 0;
    }
    @foreach (var boqheadline in Model.headlines.OrderBy(x => x.BoQnum).ThenBy(x => x.HeadLine))
    {
        if (boqheadline.Type.Equals("Mobilization"))
        {
            numRecords = Model.items.Where(x => x.MobilizationId != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (boqheadline.BoQnum + (decimal)1.0)).Count();
            if (numRecords > 0)
            {
                <h2>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</h2>
                var cost = (decimal)0.0;
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th style="width:40%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Item_Name)
                            </th>
                            <th style="width:10%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Install_date)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:15%;text-align:right">
                                    @Html.DisplayNameFor(x => x.items.First().price)
                                </th>
                            }
                            <th style="width:15%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().Amount)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:20%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Subtotal")
                                </th>
                            }
                        </tr>

                    </thead>
                    @foreach (var item in Model.items.Where(x => x.MobilizationId != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (boqheadline.BoQnum + (decimal)1.0)).OrderBy(x => x.Install_date).OrderBy(x => x.BoQNr).ThenBy(x => x.Install_date))
                    {
                        var subtotal = Convert.ToDecimal(item.price);
                        <tr>

                            <td style="text-align:left">
                                <form asp-action="Details_Mobilize" asp-controller="TrackItems" asp-route-id="@item.MobilizationId" method="get" target="_blank">
                                    <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name)</button>
                                </form>
                            </td>
                            <td style="text-align:left">@Html.DisplayFor(Model => item.Install_date)</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right">@String.Format("{0:N2} ", item.ItemType.price)@thevaluta</td>
                            }
                            <td style="text-align:right">@Html.DisplayFor(Model => item.Amount) @Html.DisplayFor(Model => item.ItemType.Install_Unit.TheUnit)</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right">@String.Format("{0:N2} ", subtotal)@thevaluta</td>
                            }
                        </tr>
                        cost += subtotal;
                        totaltotalcost += subtotal;
                    }
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <tr style="border-bottom:double;">
                            <td style="text-align:left"><b>@SharedLocalizer.GetLocalizedHtmlString("Total ") @boqheadline.HeadLine</b></td>
                            <td style="text-align:left"></td>
                            <td style="text-align:right"></td>
                            <td style="text-align:right"></td>
                            <td style="text-align:right"><b>@String.Format("{0:N2} ", cost)@thevaluta</b></td>
                        </tr>
                    }
                </table>
            }
        }
        else if (boqheadline.Type.Equals("Installation"))
        {
            numRecords = Model.items.Where(x => x.InstallationId != null && x.Install_date.Date >= Model.starttime.Date && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1) && (x.price > (decimal)0.0 || x.price < (decimal)0.0)).Count();
            if (numRecords > 0)
            {
                <h2>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</h2>
                var cost = (decimal)0.0;
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th style="width:40%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Item_Name)
                            </th>
                            <th style="width:10%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Install_date)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:15%;text-align:right">
                                    @Html.DisplayNameFor(x => x.items.First().price)
                                </th>
                            }
                            <th style="width:15%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().Amount)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:20%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Subtotal")
                                </th>
                            }
                        </tr>
                    </thead>
                    @foreach (var item in Model.items.Where(x => x.InstallationId != null && x.Install_date.Date >= Model.starttime.Date && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1) && (x.price > (decimal)0.0 || x.price < (decimal)0.0)).OrderBy(x => x.BoQNr).ThenBy(x => x.Install_date))
                    {
                        var subtotal = Convert.ToDecimal(item.price);
                        <tr>
                            <td style="text-align:left">
                                <form asp-action="Details_Install" asp-controller="TrackItems" asp-route-id="@item.InstallationId" method="get" target="_blank">
                                    @if (item.Install.UniqueID != null && item.Install.UniqueID != "N/A")
                                    {
                                        @if (item.Install.Location != "" && item.Install.Location != null)
                                        {
                                            <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) (@Html.DisplayFor(modelItem => item.Install.UniqueID)) : @Html.DisplayFor(modelItem => item.location)</button>
                                        }
                                        else
                                        {
                                            <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) (@Html.DisplayFor(modelItem => item.Install.UniqueID))</button>
                                        }
                                    }
                                    else if (item.Install.Location != "" && item.Install.Location != null)
                                    {
                                        <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) : @Html.DisplayFor(modelItem => item.location)</button>
                                    }
                                    else
                                    {
                                        <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name)</button>
                                    }
                                </form>
                            </td>
                            @try
                            {
                                <td style="text-align:left">@Html.DisplayFor(Model => item.Install_date)</td>

                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    @if (item.ItemType.Install_Unit.TheUnit.Equals("pcs"))
                                    {
                                        <td style="text-align:right">@Html.DisplayFor(Model => item.ItemType.price) @thevaluta/@Html.DisplayFor(Model => item.ItemType.Install_Unit.TheUnit)</td>
                                    }
                                    else
                                    {
                                        <td style="text-align:right">@Html.DisplayFor(Model => item.ItemType.price) @thevaluta @Html.DisplayFor(Model => item.ItemType.Install_Unit.TheUnit)</td>
                                    }
                                }
                                @if (item.ItemType.Install_Unit.TheUnit.Equals("pr. m"))
                                {
                                    <td style="text-align:right">@String.Format("{0:N2} ", item.Amount) m</td>
                                }
                                else if (item.ItemType.Install_Unit.TheUnit.Equals("pr. l"))
                                {
                                    <td style="text-align:right">@String.Format("{0:N2} ", item.Amount) l</td>
                                }
                                else
                                {
                                    <td style="text-align:right">@Html.DisplayFor(Model => item.Amount) @Html.DisplayFor(Model => item.ItemType.Install_Unit.TheUnit)</td>
                                }
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right">@String.Format("{0:N2} ", subtotal)@thevaluta</td>
                                }
                            }
                            catch
                            {
                            }

                        </tr>
                        cost += subtotal;
                        totaltotalcost += subtotal;
                        if (item.Total_Discount_Installation > (decimal)0.01)
                        {
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <tr>
                                    <td colspan="4" style="text-align:left;">@SharedLocalizer.GetLocalizedHtmlString("Discount")</td>
                                    <td style="text-align:right;">@String.Format("{0:N2} ", -item.Total_Discount_Installation)@thevaluta</td>
                                </tr>
                            }
                            cost -= (decimal)item.Total_Discount_Installation;
                            totaltotalcost -= (decimal)item.Total_Discount_Installation;
                        }
                    }
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <tr style="border-bottom:double;">
                            <td style="text-align:left"><b>@SharedLocalizer.GetLocalizedHtmlString("Total ") @boqheadline.HeadLine</b></td>
                            <td style="text-align:right"></td>
                            <td style="text-align:right"></td>
                            <td style="text-align:right"></td>
                            <td style="text-align:right"><b>@String.Format("{0:N2} ", cost)@thevaluta</b></td>
                        </tr>
                    }
                </table>
            }
        }
        else if (boqheadline.Type.Equals("Rental"))
        {
            numRecords = Model.items.Where(x => x.ArrivalId != null && (x.BoQNr_Rental >= boqheadline.BoQnum && x.BoQNr_Rental < (boqheadline.BoQnum + (decimal)1.0)) && x.rental_price > (decimal)0.0).Count();
            if (numRecords > 0)
            {
                <h2>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</h2>
                var cost = (decimal)0.0;
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th style="width:28%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Item_Name)
                            </th>
                            <th style="width:10%;text-align:left">
                                @SharedLocalizer.GetLocalizedHtmlString("Start Date")
                            </th>
                            <th style="width:10%;text-align:left">
                                @SharedLocalizer.GetLocalizedHtmlString("End Date")
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:22%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Rental Price Unit")
                                </th>
                            }
                            <th style="width:5%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().Amount)
                            </th>
                            <th style="width:8%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().Days)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:17%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Subtotal")
                                </th>
                            }
                        </tr>
                    </thead>


                    @foreach (var item in Model.items.Where(x => x.ArrivalId != null && (x.BoQNr_Rental >= boqheadline.BoQnum && x.BoQNr_Rental < (boqheadline.BoQnum + (decimal)1.0)) && x.rental_price > (decimal)0.0).OrderBy(x => x.BoQNr).ThenBy(x => x.Install_date))
                    {
                        var subtotal = Convert.ToDecimal(item.ItemType.rental_price * (decimal)item.Days * (decimal)item.Amount);


                        <tr>
                            @if (item.ArrivalId.Equals(10000))
                            {
                                @if (item.Arrival.UniqueID != null && item.Arrival.UniqueID != "N/A")
                                {
                                    <td style="text-align:left">
                                        @Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) @Html.DisplayFor(modelItem => item.Arrival.UniqueID) : @Html.DisplayFor(modelItem => item.location)
                                    </td>

                                }
                                else
                                {
                                    <td style="text-align:left">
                                        @Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) : @Html.DisplayFor(modelItem => item.location)
                                    </td>
                                }



                            }
                            else
                            {
                                if (item.Arrival.UniqueID != null && item.Arrival.UniqueID != "N/A")
                                {
                                    <td style="text-align:left">
                                        <form asp-action="Details_Arrival" asp-controller="TrackItems" asp-route-id="@item.ArrivalId" method="get" target="_blank">
                                            <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) @Html.DisplayFor(modelItem => item.Arrival.UniqueID) : @Html.DisplayFor(modelItem => item.location)</button>
                                        </form>
                                    </td>
                                }
                                else
                                {
                                    <td style="text-align:left">
                                        <form asp-action="Details_Arrival" asp-controller="TrackItems" asp-route-id="@item.ArrivalId" method="get" target="_blank">
                                            <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name) : @Html.DisplayFor(modelItem => item.location)</button>
                                        </form>
                                    </td>
                                }
                            }

                            <td style="text-align:left">@Html.DisplayFor(Model => item.Install_date)</td>
                            @if (item.Arrival != null)
                            {
                                @if (item.Arrival.EndStamp != null)
                                {
                                    <td style="text-align:left">@Html.DisplayFor(Model => item.Arrival.EndStamp)</td>
                                }
                                else
                                {
                                    if (item.Install != null)
                                    {
                                        if (item.Install.DeinstallDate != null)
                                        {
                                            <td style="text-align:left">@Html.DisplayFor(Model => item.Install.DeinstallDate)</td>
                                        }
                                        else
                                        {
                                            <td style="text-align:left">@Html.DisplayFor(Model => item.Install.DeinstallDate)</td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            }
                            else
                            {
                                <td style="text-align:left">@Html.DisplayFor(Model => item.Install.DeinstallDate)</td>
                            }
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                @if (item.ItemType.Rental_Unit.TheUnit.Equals("pr. m pr. calender day"))
                                {
                                    <td style="text-align:right">@Html.DisplayFor(Model => item.ItemType.rental_price) @thevaluta @Html.DisplayFor(Model => item.ItemType.Rental_Unit.TheUnit)</td>
                                }
                                else
                                {
                                    <td style="text-align:right">@Html.DisplayFor(Model => item.ItemType.rental_price) @thevaluta/pcs @Html.DisplayFor(Model => item.ItemType.Rental_Unit.TheUnit)</td>
                                }
                            }
                            @if (item.ItemType.Install_Unit.TheUnit.Equals("pr. m"))
                            {
                                <td style="text-align:right">@Html.DisplayFor(Model => item.Amount) m</td>
                            }
                            else
                            {
                                <td style="text-align:right">@Html.DisplayFor(Model => item.Amount) @Html.DisplayFor(Model => item.ItemType.Install_Unit.TheUnit)</td>
                            }

                            <td style="text-align:right">@Html.DisplayFor(Model => item.Days) @SharedLocalizer.GetLocalizedHtmlString("Days")</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right">@String.Format("{0:N2} ", subtotal)@thevaluta</td>
                            }
                        </tr>
                        cost += subtotal;
                        totaltotalcost += subtotal;
                        if (item.Total_Discount > (decimal)0.01)
                        {
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <tr>
                                    <td colspan="6" style="text-align:left;">@SharedLocalizer.GetLocalizedHtmlString("Discount")</td>
                                    <td style="text-align:right;">@String.Format("{0:N2} ", -item.Total_Discount)@thevaluta</td>
                                </tr>
                            }
                            cost -= (decimal)item.Total_Discount;
                            totaltotalcost -= (decimal)item.Total_Discount;
                        }
                    }
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <tr style="border-bottom:double;">
                            <td style="text-align:left"><b>@SharedLocalizer.GetLocalizedHtmlString("Total Rental Cost")</b></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td style="text-align:right"><b>@String.Format("{0:N2} ", cost)@thevaluta</b></td>
                        </tr>
                    }
                </table>
            }
        }
        else if (boqheadline.Type.Equals("Hours"))
        {
            numRecords = Model.items.Where(x => x.Daily_Report_2Id != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1)).Count();
            if (numRecords > 0)
            {
                <h2>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</h2>
                var cost = (decimal)0.0;
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th style="width:35%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Item_Name)
                            </th>
                            <th style="width:10%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Install_date)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:15%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Hour Rate")
                                </th>
                            }
                            <th style="width:10%;text-align:right">
                                @SharedLocalizer.GetLocalizedHtmlString("People")
                            </th>
                            <th style="width:10%;text-align:right">
                                @SharedLocalizer.GetLocalizedHtmlString("Hours(excl. Break)")
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:20%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Subtotal")
                                </th>
                            }
                        </tr>
                    </thead>
                    @foreach (var item in Model.items.Where(x => x.Daily_Report_2Id != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1)).OrderBy(x => x.BoQNr).ThenBy(x => x.Install_date))
                    {
                        var subtotal = (decimal)0.0;
                        @if (item.rental_price != null && item.price != null)
                        {
                            subtotal = Convert.ToDecimal(item.rental_price) + Convert.ToDecimal(item.price);
                        }
                        else
                        {
                            if (item.rental_price != null)
                            {
                                subtotal = Convert.ToDecimal(item.rental_price);
                            }
                            else
                            {
                                subtotal = Convert.ToDecimal(item.price);
                            }
                        }

                        <tr>
                            <td style="text-align:left">
                                <form asp-action="Daily_Report_2_DetailsPdf" asp-controller="TrackItems" asp-route-id="@item.Daily_Report_2Id" method="get" target="_blank">
                                    <button>@Html.DisplayFor(modelItem => item.BoQNr) : @Html.DisplayFor(modelItem => item.Item_Name)</button>
                                </form>
                            </td>
                            <td style="text-align:left">@Html.DisplayFor(modelItem => item.Install_date)</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right">@Html.DisplayFor(modelItem => item.ItemType.rental_price) @thevaluta/Hour </td>
                            }
                            <td style="text-align:right">@Html.DisplayFor(modelItem => item.Amount) @SharedLocalizer.GetLocalizedHtmlString("People")</td>
                            <td style="text-align:right">@String.Format("{0:N2} ", item.Days) @SharedLocalizer.GetLocalizedHtmlString("Hours")</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right">@String.Format("{0:N2} ", subtotal)@thevaluta</td>
                            }
                        </tr>
                        cost += subtotal;
                        totaltotalcost += subtotal;
                        if (item.Total_Discount > (decimal)0.01)
                        {
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <tr>
                                    <td colspan="5" style="text-align:left;">@SharedLocalizer.GetLocalizedHtmlString("Discount")</td>
                                    <td style="text-align:right;">@String.Format("{0:N2} ", -item.Total_Discount)@thevaluta</td>
                                </tr>
                            }
                            cost -= (decimal)item.Total_Discount;
                            totaltotalcost -= (decimal)item.Total_Discount;
                        }
                    }
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <tr style="border-bottom:double;">
                            <td style="text-align:left"><b>@SharedLocalizer.GetLocalizedHtmlString("Total ") @boqheadline.HeadLine</b></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td style="text-align:right"><b>@String.Format("{0:N2} ", cost)@thevaluta</b></td>
                        </tr>
                    }
                </table>
            }
        }
        else if (boqheadline.Type.Equals("ExtraWork"))
        {
            numRecords = Model.items.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId.Equals(boqheadline.Id)).Count();
            if (numRecords > 0)
            {
                var cost = (decimal)0.0;
                <h2>@boqheadline.HeadLine</h2>
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th style="width:30%;text-align:left">
                                @Html.DisplayNameFor(x => x.items.First().Item_Name)
                            </th>
                            <th style="width:10%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().ExtraWork.TimeStamp)
                            </th>
                            <th style="width:10%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().ExtraWork.EndStamp)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:10%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Install Price")
                                </th>
                                <th style="width:10%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Rental")
                                </th>
                            }
                            <th style="width:5%;text-align:right">
                                @Html.DisplayNameFor(x => x.items.First().Days)
                            </th>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <th style="width:10%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Rental Total")
                                </th>
                                <th style="width:15%;text-align:right">
                                    @SharedLocalizer.GetLocalizedHtmlString("Subtotal")
                                </th>
                            }
                        </tr>
                    </thead>
                    @foreach (var item in Model.items.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId.Equals(boqheadline.Id)))
                    {
                        var subtotal = (decimal)0.0;
                        @if (item.rental_price != null && item.price != null)
                        {
                            subtotal = Convert.ToDecimal(item.rental_price) + Convert.ToDecimal(item.price);
                        }
                        else
                        {
                            if (item.rental_price != null)
                            {
                                subtotal = Convert.ToDecimal(item.rental_price);
                            }
                            else
                            {
                                subtotal = Convert.ToDecimal(item.price);
                            }
                        }

                        <tr>

                            <td style="text-align:left">
                                <form asp-action="Details" asp-controller="ExtraWorks" asp-route-id="@item.ExtraWorkId" method="get" target="_blank">
                                    <button class="btn-hoelscher" style="text-align:left;">@Html.DisplayFor(modelItem => item.Item_Name)</button>
                                </form>
                            </td>
                            <td style="text-align:right">@Html.DisplayFor(Model => item.ExtraWork.TimeStamp)</td>
                            <td style="text-align:right">@Html.DisplayFor(Model => item.ExtraWork.EndStamp)</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                @if (item.price != null)
                                {
                                    <td style="text-align:right">@Html.DisplayFor(Model => item.price) @thevaluta</td>
                                }
                                else
                                {
                                    <td style="text-align:right">0.00 @thevaluta</td>
                                }
                            }
                            @if (item.rental_price > (decimal)0.0)
                            {
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right">@Html.DisplayFor(Model => item.ExtraWork.Rental_Price) @thevaluta/@SharedLocalizer.GetLocalizedHtmlString("calender day")</td>
                                }
                                <td style="text-align:right">@Html.DisplayFor(Model => item.Days)</td>
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right">@Html.DisplayFor(Model => item.rental_price) @thevaluta</td>
                                }
                            }
                            else
                            {
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right"></td>
                                }
                                <td style="text-align:right"></td>
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right"></td>
                                }
                            }
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right">@String.Format("{0:N2} ", subtotal)@thevaluta</td>
                            }
                        </tr>
                        cost += subtotal;
                        totaltotalcost += subtotal;
                    }
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <tr style="border-bottom:double;">
                            <td style="text-align:left"><b>@SharedLocalizer.GetLocalizedHtmlString("Total ")@boqheadline.HeadLine</b></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td style="text-align:right"><b>@String.Format("{0:N2} ", cost)@thevaluta</b></td>
                        </tr>
                    }
                </table>
            }
        }
        else
        {
            @SharedLocalizer.GetLocalizedHtmlString("BLAH BLAH BLAH HOW TO HANDLE SHIT")
            <text>boqheadline type: @boqheadline.Type</text>
            @SharedLocalizer.GetLocalizedHtmlString("BLAH BLAH BLAH HOW TO HANDLE SHIT")
        }
    }

    @if (Model.items.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId == null).Count() > 0)
    {
        var cost = (decimal)0.0;
        <h2>@SharedLocalizer.GetLocalizedHtmlString("Extra Works")</h2>
        <table style="width:100%">
            <thead>
                <tr>
                    <th style="width:30%;text-align:left">
                        @Html.DisplayNameFor(x => x.items.First().Item_Name)
                    </th>
                    <th style="width:10%;text-align:right">
                        @Html.DisplayNameFor(x => x.items.First().ExtraWork.TimeStamp)
                    </th>
                    <th style="width:10%;text-align:right">
                        @Html.DisplayNameFor(x => x.items.First().ExtraWork.EndStamp)
                    </th>
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <th style="width:10%;text-align:right">
                            @SharedLocalizer.GetLocalizedHtmlString("Install Price")
                        </th>
                        <th style="width:10%;text-align:right">
                            @SharedLocalizer.GetLocalizedHtmlString("Rental")
                        </th>
                    }
                    <th style="width:5%;text-align:right">
                        @Html.DisplayNameFor(x => x.items.First().Days)
                    </th>
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <th style="width:10%;text-align:right">
                            @SharedLocalizer.GetLocalizedHtmlString("Rental Total")
                        </th>
                        <th style="width:15%;text-align:right">
                            @SharedLocalizer.GetLocalizedHtmlString("Subtotal")
                        </th>
                    }
                </tr>
            </thead>
            @foreach (var item in Model.items.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId == null))
            {
                var subtotal = (decimal)0.0;
                @if (item.rental_price != null && item.price != null)
                {
                    subtotal = Convert.ToDecimal(item.rental_price) + Convert.ToDecimal(item.price);
                }
                else
                {
                    if (item.rental_price != null)
                    {
                        subtotal = Convert.ToDecimal(item.rental_price);
                    }
                    else
                    {
                        subtotal = Convert.ToDecimal(item.price);
                    }
                }

                <tr>
                    <td style="text-align:left">
                        <form asp-action="Details" asp-controller="ExtraWorks" asp-route-id="@item.ExtraWorkId" method="get" target="_blank">
                            <button class="btn-hoelscher" style="text-align:left;">@Html.DisplayFor(modelItem => item.Item_Name)</button>
                        </form>
                    </td>
                    <td style="text-align:right">@Html.DisplayFor(Model => item.ExtraWork.TimeStamp)</td>
                    <td style="text-align:right">@Html.DisplayFor(Model => item.ExtraWork.EndStamp)</td>
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        @if (item.price != null)
                        {
                            <td style="text-align:right">@Html.DisplayFor(Model => item.price) @thevaluta</td>
                        }
                        else
                        {
                            <td style="text-align:right">0.00 @thevaluta</td>
                        }
                    }
                    @if (item.rental_price > (decimal)0.0)
                    {
                        @if (Model.NoMoneyNumbers.Equals(false))
                        {
                            <td style="text-align:right">@Html.DisplayFor(Model => item.ExtraWork.Rental_Price) @thevaluta/@SharedLocalizer.GetLocalizedHtmlString("calender day")</td>
                        }
                        <td style="text-align:right">@Html.DisplayFor(Model => item.Days)</td>
                        @if (Model.NoMoneyNumbers.Equals(false))
                        {
                            <td style="text-align:right">@Html.DisplayFor(Model => item.rental_price) @thevaluta</td>
                        }
                    }
                    else
                    {
                        @if (Model.NoMoneyNumbers.Equals(false))
                        {
                            <td style="text-align:right"></td>
                        }
                        <td style="text-align:right"></td>
                        @if (Model.NoMoneyNumbers.Equals(false))
                        {
                            <td style="text-align:right"></td>
                        }
                    }
                    @if (Model.NoMoneyNumbers.Equals(false))
                    {
                        <td style="text-align:right">@String.Format("{0:N2} ", subtotal)@thevaluta</td>
                    }
                </tr>
                cost += subtotal;
                totaltotalcost += subtotal;
            }
            @if (Model.NoMoneyNumbers.Equals(false))
            {
                <tr style="border-bottom:double;">
                    <td style="text-align:left"><b>@SharedLocalizer.GetLocalizedHtmlString("Total Extra Work Cost")</b></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td style="text-align:right"><b>@String.Format("{0:N2} ", cost)@thevaluta</b></td>
                </tr>
            }
        </table>
    }
    <br />
    <br />
    @if (Model.NoMoneyNumbers.Equals(false))
    {
        <table style="width:100%;page-break-after:always;">
            <tr style="border-bottom:double;">
                <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Total (excl. VAT)")</b></td>
                <td colspan="5" style="text-align:right"><b>@String.Format("{0:N2} ", totaltotalcost)@thevaluta</b></td>
            </tr>
            <tr style="border-bottom:double;">
                <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Previously Applied (excl. VAT)")</b></td>
                <td colspan="5" style="text-align:right"><b>@String.Format("{0:N2} ", Model.Payments.Sum(x => x.Amount))@thevaluta</b></td>
            </tr>
            <tr style="border-bottom:double;">
                <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Remainder to be paid (excl. VAT)")</b></td>
                <td colspan="5" style="text-align:right"><b>@String.Format("{0:N2} ", totaltotalcost - Model.Payments.Sum(x => x.Amount))@thevaluta</b></td>
            </tr>
            <tr style="border-bottom:double;">
                <td style="text-align:left;"><b></b></td>
                <td colspan="5" style="text-align:right"><b></b></td>
            </tr>
            <tr style="border-bottom:double;">
                <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Already Invoiced This Period (excl. VAT)")</b></td>
                <td colspan="5" style="text-align:right"><b>@String.Format("{0:N2} ", Model.Invoices.Sum(x => x.Amount))@thevaluta</b></td>
            </tr>
            <tr style="border-bottom:double;">
                <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Remainder to be invoiced This Period (excl. VAT)")</b></td>
                <td colspan="5" style="text-align:right"><b>@String.Format("{0:N2} ", totaltotalcost - Model.Invoices.Sum(x => x.Amount))@thevaluta</b></td>
            </tr>
        </table>
    }
    @if (Model.HideOldItems.Equals(false))
    {
        <h2>@SharedLocalizer.GetLocalizedHtmlString("Summary Table")</h2>
    }
    else
    {
        <h2>@SharedLocalizer.GetLocalizedHtmlString("Summary Table - Old items hidden.")</h2>
    }
    @{ var totalalways = (decimal)0.0;}
    @{ var totalthis = (decimal)0.0;}
    <table style="width:100%;page-break-inside:avoid;page-break-after:always !important">
        <thead>
            <tr>
                <th style="text-align:left;">@SharedLocalizer.GetLocalizedHtmlString("Item Name")</th>
                <th style="text-align:right;">@SharedLocalizer.GetLocalizedHtmlString("Total Cumulative Amount")</th>
                @if (Model.NoMoneyNumbers.Equals(false))
                {
                    <th style="text-align:right;">@SharedLocalizer.GetLocalizedHtmlString("Total Cumulative Cost")</th>
                }
                <th style="text-align:right;">@SharedLocalizer.GetLocalizedHtmlString("Total This Period")</th>
                @if (Model.NoMoneyNumbers.Equals(false))
                {
                    <th style="text-align:right;">@SharedLocalizer.GetLocalizedHtmlString("Total This Period Cost")</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var boqheadline in Model.headlines.OrderBy(x => x.BoQnum).ThenBy(x => x.HeadLine))
            {

                if (boqheadline.Type.Equals("Mobilization"))
                {
                    numRecords = Model.allItems.Where(x => x.MobilizationId != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (boqheadline.BoQnum + (decimal)1.0)).GroupBy(x => x.Item_Name).Count();
                    if (numRecords > 0)
                    {
                        <tr style="text-align:left;">
                            <td colspan="5" style="text-align:left;">
                                <b>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</b>
                            </td>
                        </tr>
                        @foreach (var itemtype in Model.allItems.Where(x => x.MobilizationId != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (boqheadline.BoQnum + (decimal)1.0)).GroupBy(x => x.Item_Name))
                        {
                            var totalamountmobilized = Model.items.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId)).Sum(x => x.Amount);
                            var totalamountmobilizedalways = Model.allItems.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId)).Sum(x => x.Amount);
                            var totalcostMobilizedalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.MobilizationId != null).Sum(x => x.price);
                            var totalcostMobilized = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.MobilizationId != null).Sum(x => x.price);
                            totalalways += (decimal)totalcostMobilizedalways;
                            totalthis += (decimal)totalcostMobilized;
                            if (Model.HideOldItems.Equals(false))
                            {


                                <tr>
                                    <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                    <td style="text-align:right;">@totalamountmobilizedalways</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostMobilizedalways)@thevaluta</td>
                                    }
                                    <td style="text-align:right;">@totalamountmobilized</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostMobilized)@thevaluta</td>
                                    }
                                </tr>
                            }
                            else
                            {
                                if (totalamountmobilized > 0)
                                {
                                    <tr>
                                        <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                        <td style="text-align:right;">@totalamountmobilizedalways</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostMobilizedalways)@thevaluta</td>
                                        }
                                        <td style="text-align:right;">@totalamountmobilized</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostMobilized)@thevaluta</td>
                                        }
                                    </tr>
                                }
                            }
                        }
                    }
                }
                else if (boqheadline.Type.Equals("Installation"))
                {
                    numRecords = Model.allItems.Where(x => x.InstallationId != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1)).Count();
                    if (numRecords > 0)
                    {

                        <tr style="text-align:left;">
                            <td colspan="5" style="text-align:left;">
                                <b>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</b>
                            </td>
                        </tr>
                        @foreach (var itemtype in Model.allItems.Where(x => x.InstallationId != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1)).GroupBy(x => x.Item_Name))
                        {
                            var totalamountinstalled = Model.items.Where(x => x.Install_date.Date >= Model.starttime.Date && x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.InstallationId != null).Sum(x => x.Amount);
                            var totalamountinstalledalways = Model.allItems.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.InstallationId != null).Sum(x => x.Amount);
                            var totalcostInstalledalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.InstallationId != null).Sum(x => x.price - x.Total_Discount_Installation);
                            var totalcostInstalled = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.InstallationId != null).Sum(x => x.price - x.Total_Discount_Installation);
                            totalalways += (decimal)totalcostInstalledalways;
                            totalthis += (decimal)totalcostInstalled;
                            if (Model.HideOldItems.Equals(false))
                            {


                                <tr>
                                    <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                    <td style="text-align:right;">@String.Format("{0:N2} ", totalamountinstalledalways)</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalledalways)@thevaluta</td>
                                    }
                                    <td style="text-align:right;">@String.Format("{0:N2} ", totalamountinstalled)</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalled)@thevaluta</td>
                                    }
                                </tr>
                            }
                            else
                            {
                                if (totalamountinstalled > 0)
                                {
                                    <tr>
                                        <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalamountinstalledalways)</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalledalways)@thevaluta</td>
                                        }
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalamountinstalled)</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalled)@thevaluta</td>
                                        }
                                    </tr>
                                }
                            }
                        }
                    }
                }
                else if (boqheadline.Type.Equals("Rental"))
                {
                    numRecords = Model.allItems.Where(x => x.ArrivalId != null && (x.BoQNr_Rental >= boqheadline.BoQnum && (x.BoQNr_Rental < (boqheadline.BoQnum + (decimal)1.0))) && x.rental_price > (decimal)0.0).Count();
                    if (numRecords > 0)
                    {
                        <tr style="text-align:left;">
                            <td colspan="5" style="text-align:left;">
                                <b>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</b>
                            </td>
                        </tr>
                        @foreach (var itemtype in Model.allItems.Where(x => x.ArrivalId != null && (x.BoQNr_Rental >= boqheadline.BoQnum && (x.BoQNr_Rental < (boqheadline.BoQnum + (decimal)1.0))) && x.rental_price > (decimal)0.0).GroupBy(x => x.Item_Name))
                        {
                            var totalamountarrived = Model.items.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.ArrivalId != null && x.Install_date.Date <= Model.endtime.Date && (x.Arrival.EndStamp == null || x.Arrival.EndStamp >= Model.starttime)).Sum(x => x.Amount);
                            var totalamountarrivedalways = Model.allItems.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.ArrivalId != null).Sum(x => x.Amount);
                            var totalcostarrivedalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ArrivalId != null).Sum(x => (decimal)x.Amount * (decimal)x.Days * x.ItemType.rental_price - (decimal)x.Total_Discount);
                            var totalcostarrived = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ArrivalId != null && x.Install_date.Date <= Model.endtime.Date && (x.Arrival.EndStamp == null || x.Arrival.EndStamp >= Model.starttime)).Sum(x => (decimal)x.Amount * (decimal)x.Days * x.ItemType.rental_price - (decimal)x.Total_Discount);
                            totalalways += (decimal)totalcostarrivedalways;
                            totalthis += (decimal)totalcostarrived;
                            if (Model.HideOldItems.Equals(false))
                            {


                                <tr>
                                    <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                    <td style="text-align:right;">@totalamountarrivedalways</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostarrivedalways)@thevaluta</td>
                                    }
                                    <td style="text-align:right;">@totalamountarrived</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostarrived)@thevaluta</td>
                                    }
                                </tr>
                            }
                            else
                            {
                                if (totalamountarrived > 0)
                                {
                                    <tr>
                                        <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                        <td style="text-align:right;">@totalamountarrivedalways</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostarrivedalways)@thevaluta</td>
                                        }
                                        <td style="text-align:right;">@totalamountarrived</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostarrived)@thevaluta</td>
                                        }
                                    </tr>
                                }
                            }
                        }
                        @foreach (var itemtype in Model.allItems.Where(x => x.InstallationId != null && x.rental_price > (decimal)0.0 && (Convert.ToInt32(x.BoQNr_Rental).Equals(Convert.ToInt32(boqheadline.BoQnum)) && x.BoQNr_Rental < (boqheadline.BoQnum + (decimal)1.0))).GroupBy(x => x.Item_Name))
                        {
                            //here centrifugals are added again!!!!
                            //change from items to allitems!!
                            var arrivalitem = Model.allItems.Where(x => x.ArrivalId != null && x.ItemTypeId.Equals(itemtype.First().ItemTypeId)).ToList();
                            if (arrivalitem.Count() < 1)
                            {
                                var totalamountinstalled = Model.items.Where(x => x.Install_date.Date >= Model.starttime.Date && x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.InstallationId != null).Sum(x => x.Amount);
                                var totalamountinstalledalways = Model.allItems.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.InstallationId != null).Sum(x => x.Amount);
                                var totalcostInstalledalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.InstallationId != null).Sum(x => x.rental_price);
                                var totalcostInstalled = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.InstallationId != null).Sum(x => x.rental_price);
                                totalalways += (decimal)totalcostInstalledalways;
                                totalthis += (decimal)totalcostInstalled;
                                if (Model.HideOldItems.Equals(false))
                                {


                                    <tr>
                                        <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                        <td style="text-align:right;">@totalamountinstalledalways</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalledalways)@thevaluta</td>
                                        }
                                        <td style="text-align:right;">@totalamountinstalled</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalled)@thevaluta</td>
                                        }
                                    </tr>
                                }
                                else
                                {
                                    if (totalamountinstalled > 0)
                                    {
                                        <tr>
                                            <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                            <td style="text-align:right;">@totalamountinstalledalways</td>
                                            @if (Model.NoMoneyNumbers.Equals(false))
                                            {
                                                <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalledalways)@thevaluta</td>
                                            }
                                            <td style="text-align:right;">@totalamountinstalled</td>
                                            @if (Model.NoMoneyNumbers.Equals(false))
                                            {
                                                <td style="text-align:right;">@String.Format("{0:N2} ", totalcostInstalled)@thevaluta</td>
                                            }
                                        </tr>
                                    }
                                }
                            }
                        }
                    }
                }
                else if (boqheadline.Type.Equals("Hours"))
                {
                    numRecords = Model.allItems.Where(x => x.Daily_Report_2Id != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1)).GroupBy(x => x.Item_Name).Count();
                    if (numRecords > 0)
                    {
                        <tr style="text-align:left;">
                            <td colspan="5" style="text-align:left;">
                                <b>@SharedLocalizer.GetLocalizedHtmlString(boqheadline.HeadLine)</b>
                            </td>
                        </tr>
                        @foreach (var itemtype in Model.allItems.Where(x => x.Daily_Report_2Id != null && x.BoQNr >= boqheadline.BoQnum && x.BoQNr < (decimal)(boqheadline.BoQnum + 1)).GroupBy(x => x.Item_Name))
                        {
                            var totalamounthours = Model.items.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.InstallationId == null && x.MobilizationId == null && x.ArrivalId == null).Sum(x => x.Days);
                            var totalamounthoursalways = Model.allItems.Where(x => x.ItemTypeId.Equals(itemtype.First().ItemTypeId) && x.InstallationId == null && x.MobilizationId == null && x.ArrivalId == null).Sum(x => x.Days);
                            var totalcostHoursalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ArrivalId == null && x.InstallationId == null && x.MobilizationId == null).Sum(x => x.rental_price - x.Total_Discount);
                            var totalcostHours = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ArrivalId == null && x.InstallationId == null && x.MobilizationId == null).Sum(x => x.rental_price - x.Total_Discount);
                            totalalways += (decimal)totalcostHoursalways;
                            totalthis += (decimal)totalcostHours;
                            if (Model.HideOldItems.Equals(false))
                            {
                                <tr>
                                    <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                    <td style="text-align:right;">@String.Format("{0:N2} ", totalamounthoursalways)</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostHoursalways)@thevaluta</td>
                                    }
                                    <td style="text-align:right;">@String.Format("{0:N2} ", totalamounthours)</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostHours)@thevaluta</td>
                                    }
                                </tr>
                            }
                            else
                            {
                                if (totalamounthours > 0)
                                {
                                    <tr>
                                        <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalamounthoursalways)</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostHoursalways)@thevaluta</td>
                                        }
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalamounthours)</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostHours)@thevaluta</td>
                                        }
                                    </tr>
                                }
                            }
                        }
                    }
                }
                else if (boqheadline.Type.Equals("ExtraWork"))
                {
                    numRecords = Model.allItems.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId.Equals(boqheadline.Id)).Count();

                    if (numRecords > 0)
                    {
                        <tr style="text-align:left;">
                            <td colspan="5" style="text-align:left;">
                                <b>@boqheadline.HeadLine</b>
                            </td>
                        </tr>

                        @foreach (var itemtype in Model.allItems.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId.Equals(boqheadline.Id)).GroupBy(x => x.Item_Name))
                        {
                            var totalamountExtraWork = Model.items.Where(x => x.Install_date.Date >= Model.starttime.Date && x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.Amount);
                            var totalamountExtraWorkalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.Amount);
                            var totalcostExtraWorkalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price + x.price);
                            var totalcostExtraWorkalwaysrental = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price);
                            var totalcostExtraWork = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price + x.price);
                            var totalcostExtraWorkrental = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price);
                            totalalways += (decimal)totalcostExtraWorkalways;
                            totalthis += (decimal)totalcostExtraWork;
                            if (Model.HideOldItems.Equals(false))
                            {
                                <tr>
                                    <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                    <td style="text-align:right;">@totalamountExtraWorkalways</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWorkalways)@thevaluta</td>
                                    }
                                    <td style="text-align:right;">@totalamountExtraWork</td>
                                    @if (Model.NoMoneyNumbers.Equals(false))
                                    {
                                        <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWork)@thevaluta</td>
                                    }
                                </tr>
                            }
                            else
                            {
                                if (totalamountExtraWork > 0)
                                {
                                    <tr>
                                        <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                        <td style="text-align:right;">@totalamountExtraWorkalways</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWorkalways)@thevaluta</td>
                                        }
                                        <td style="text-align:right;">@totalamountExtraWork</td>
                                        @if (Model.NoMoneyNumbers.Equals(false))
                                        {
                                            <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWork)@thevaluta</td>
                                        }
                                    </tr>
                                }
                            }

                        }
                    }
                }
            }
            @{ numRecords = Model.allItems.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId == null).Count();}
            @if (numRecords > 0)
            {
                <tr style="text-align:left;">
                    <td colspan="5" style="text-align:left;">
                        <b>@SharedLocalizer.GetLocalizedHtmlString("Extra Works")</b>
                    </td>
                </tr>
                @foreach (var itemtype in Model.allItems.Where(x => x.ExtraWorkId != null && x.ExtraWork.BoQHeadLineId == null).GroupBy(x => x.Item_Name))
                {
                    var totalamountExtraWork = Model.items.Where(x => x.Install_date.Date >= Model.starttime.Date && x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.Amount);
                    var totalamountExtraWorkalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.Amount);
                    var totalcostExtraWorkalways = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price + x.price);
                    var totalcostExtraWorkalwaysrental = Model.allItems.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price);
                    var totalcostExtraWork = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price + x.price);
                    var totalcostExtraWorkrental = Model.items.Where(x => x.Item_Name.Equals(itemtype.First().Item_Name) && x.ExtraWorkId != null).Sum(x => x.rental_price);
                    totalalways += (decimal)totalcostExtraWorkalways;
                    totalthis += (decimal)totalcostExtraWork;
                    if (Model.HideOldItems.Equals(false))
                    {
                        <tr>
                            <td style="text-align:left;">@itemtype.First().Item_Name</td>
                            <td style="text-align:right;">@totalamountExtraWorkalways</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWorkalways)@thevaluta</td>
                            }
                            <td style="text-align:right;">@totalamountExtraWork</td>
                            @if (Model.NoMoneyNumbers.Equals(false))
                            {
                                <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWork)@thevaluta</td>
                            }
                        </tr>
                    }
                    else
                    {
                        if (totalamountExtraWork > 0)
                        {
                            <tr>
                                <td style="text-align:left;">@itemtype.First().Item_Name</td>
                                <td style="text-align:right;">@totalamountExtraWorkalways</td>
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWorkalways)@thevaluta</td>
                                }
                                <td style="text-align:right;">@totalamountExtraWork</td>
                                @if (Model.NoMoneyNumbers.Equals(false))
                                {
                                    <td style="text-align:right;">@String.Format("{0:N2} ", totalcostExtraWork)@thevaluta</td>
                                }
                            </tr>
                        }
                    }
                }
            }
            @if (Model.NoMoneyNumbers.Equals(false))
            {
                <tr style="border-bottom:double">
                    <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Total (excl. VAT)")</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", totalalways)@thevaluta</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", totalthis)@thevaluta</b></td>
                </tr>
                <tr style="border-bottom:double;">
                    <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Previously Applied (excl. VAT)")</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", Model.AllPayments.Sum(x => x.Amount))@thevaluta</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", Model.Payments.Sum(x => x.Amount))@thevaluta</b></td>
                </tr>
                <tr style="border-bottom:double;">
                    <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Remainder to be Paid (excl. VAT)")</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", totalalways - Model.AllPayments.Sum(x => x.Amount))@thevaluta</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", totalthis - Model.Payments.Sum(x => x.Amount))@thevaluta</b></td>
                </tr>
                <tr style="border-bottom:double;">
                    <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Previously Invoiced (excl. VAT)")</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", Model.AllInvoices.Sum(x => x.Amount))@thevaluta</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", Model.Invoices.Sum(x => x.Amount))@thevaluta</b></td>
                </tr>
                <tr style="border-bottom:double;">
                    <td style="text-align:left;"><b>@SharedLocalizer.GetLocalizedHtmlString("Remainder to be Invoiced (excl. VAT)")</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", totalalways - Model.AllInvoices.Sum(x => x.Amount))@thevaluta</b></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"><b>@String.Format("{0:N2} ", totalthis - Model.Invoices.Sum(x => x.Amount))@thevaluta</b></td>
                </tr>
            }
        </tbody>
    </table>

